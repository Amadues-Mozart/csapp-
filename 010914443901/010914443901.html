<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="generator" content="Aspose.Words for .NET 15.1.0.0" /><title>第1章绪论</title></head><body><div><p style="font-size:14pt; line-height:125%; margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:14pt; font-weight:bold">&#xa0;</span></p><p style="font-size:14pt; line-height:125%; margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:14pt; font-weight:bold">&#xa0;</span></p><p style="font-size:10.5pt; line-height:125%; margin:0pt; orphans:0; text-align:center; widows:0"><a name="_Toc8970076"><img src="56ddce64-b647-4733-ad58-b72a90290a85.001.jpeg" width="242" height="45" alt="" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></a></p><p style="line-height:12pt; margin:0pt 87.9pt 0pt 0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:26pt; font-weight:bold; letter-spacing:1pt">&#xa0;</span></p><p style="font-size:42pt; line-height:125%; margin:0pt 0.2pt 0pt 0pt; orphans:0; text-align:center; widows:0"><span style="font-family:华文新魏; font-size:42pt; font-weight:bold; letter-spacing:1pt">计算机系统</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><p style="font-size:24pt; line-height:125%; margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:宋体; font-size:24pt; font-weight:bold">大作业</span></p><p style="font-size:14pt; line-height:125%; margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:14pt">&#xa0;</span></p><p style="font-size:14pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:14pt">&#xa0;</span></p><p style="font-size:18pt; line-height:175%; margin:0pt; orphans:0; text-align:justify; text-indent:44.75pt; widows:0"><span style="font-family:黑体; font-size:18pt">题 </span><span style="font-family:黑体; font-size:18pt">   </span><span style="font-family:黑体; font-size:18pt"> 目</span><span style="font-family:黑体; font-size:14pt"> </span><span style="font-family:黑体; font-size:18pt; text-decoration:underline"> 程序人生</span><span style="font-family:'Times New Roman'; font-size:18pt; text-decoration:underline">-Hello</span><span style="font-family:'Times New Roman'; font-size:18pt; text-decoration:underline">’</span><span style="font-family:'Times New Roman'; font-size:18pt; text-decoration:underline">s P2P</span><span style="width:12.74pt; text-indent:0pt; font-family:'Lucida Console'; font-size:18pt; text-decoration:underline; display:inline-block">&#xa0;</span><span style="font-family:'Times New Roman'; font-size:14pt; text-decoration:underline"> </span></p><p style="font-size:15pt; line-height:175%; margin:0pt; orphans:0; text-align:justify; text-indent:53.75pt; widows:0"><span style="font-family:黑体; font-size:15pt">专       业 </span><span style="font-family:黑体; font-size:15pt; text-decoration:underline">  </span><span style="font-family:黑体; font-size:15pt; text-decoration:underline">计算机科学与技术</span><span style="font-family:黑体; font-size:15pt; text-decoration:underline">                     </span></p><p style="font-size:15pt; line-height:175%; margin:0pt; orphans:0; text-align:justify; text-indent:53.75pt; widows:0"><span style="font-family:黑体; font-size:15pt">学　　   号 </span><span style="font-family:黑体; font-size:15pt; text-decoration:underline"> </span><span style="font-family:黑体; font-size:15pt; text-decoration:underline"> </span><span style="font-family:'Times New Roman'; font-size:15pt; text-decoration:underline">1180301009</span><span style="font-family:'Times New Roman'; font-size:15pt; text-decoration:underline">     </span></p><p style="font-size:15pt; line-height:175%; margin:0pt; orphans:0; text-align:justify; text-indent:53.75pt; widows:0"><span style="font-family:黑体; font-size:15pt">班</span><span style="font-family:黑体; font-size:15pt">　　   </span><span style="font-family:黑体; font-size:15pt">级</span><span style="font-family:黑体; font-size:15pt"> </span><span style="font-family:黑体; font-size:15pt; text-decoration:underline">  </span><span style="font-family:'Times New Roman'; font-size:15pt; text-decoration:underline">1803010</span><span style="font-family:'Times New Roman'; font-size:15pt; text-decoration:underline">                     </span></p><p style="font-size:15pt; line-height:175%; margin:0pt; orphans:0; text-align:justify; text-indent:53.75pt; widows:0"><span style="font-family:黑体; font-size:15pt">学       生 </span><span style="font-family:黑体; font-size:15pt; text-decoration:underline">  </span><span style="font-family:黑体; font-size:15pt; text-decoration:underline">阚嘉良</span><span style="font-family:黑体; font-size:15pt; text-decoration:underline">               　　　</span></p><p style="font-size:15pt; line-height:175%; margin:0pt; orphans:0; text-align:justify; text-indent:53.75pt; widows:0"><span style="font-family:黑体; font-size:15pt">指 导 教 师</span><span style="font-family:黑体; font-size:15pt"> </span><span style="font-family:黑体; font-size:15pt; text-decoration:underline">  </span><span style="font-family:黑体; font-size:15pt; text-decoration:underline">史先俊</span><span style="font-family:黑体; font-size:15pt; text-decoration:underline">                  　　</span></p><p style="font-size:14pt; line-height:125%; margin:0pt 67pt 0pt 0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:14pt">&#xa0;</span></p><p style="font-size:14pt; line-height:125%; margin:0pt 67pt 0pt 0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:14pt">&#xa0;</span></p><p style="font-size:14pt; line-height:125%; margin:0pt 67pt 0pt 0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:14pt">&#xa0;</span></p><p style="font-size:14pt; line-height:125%; margin:0pt 67pt 0pt 0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:14pt">&#xa0;</span></p><p style="font-size:14pt; line-height:125%; margin:0pt 67pt 0pt 0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:14pt">&#xa0;</span></p><p style="font-size:14pt; line-height:125%; margin:0pt 67pt 0pt 0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:14pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="-aw-bookmark-end:_Toc8970076"></span><span style="font-family:黑体; font-size:22pt; font-weight:bold">计算机科学与技术学院</span></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:黑体; font-size:18pt; font-weight:bold">2019年12月</span></p><p style="font-size:18pt; line-height:125%; margin:12pt 0pt 9.6pt; orphans:0; page-break-before:always; text-align:center; widows:0"><a name="_Toc225579639"></a><a name="_Toc250450163"><span style="font-family:黑体; font-size:18pt; font-weight:bold">摘  要</span><span style="-aw-bookmark-end:_Toc225579639"></span></a></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">摘要是论文内容的高度概括，应具有独立性和自含性，即不阅读论文的全文，就能获得必要的信息。摘要应包括本论文的目的、主要内容、方法、成果及其理论与实际意义。摘要中不宜使用公式、结构式、图表和非公知公用的符号与术语，不标注引用文献编号，同时避免将摘要写成目录式的内容介绍。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">&#xa0;</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt; font-weight:bold">关键词：</span><span style="font-family:宋体; font-size:12pt">P2P；020；进程；计算机系统</span><span style="font-family:宋体; font-size:12pt">                            </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">&#xa0;</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; widows:0"><span style="font-family:宋体; font-size:12pt; font-weight:normal">本文主要是通过合理运用这个学期在计算机系统课程上学习的知识，分析研</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">究</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">hello程序在Linux下的P2P和020过程，通过熟练使用各种工具，学习Linux</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">框</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">架下整个程序的声明周期，加深对课本知识的印象。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">&#xa0;</span></p><p style="font-size:18pt; line-height:125%; margin:12pt 0pt 0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:18pt; font-weight:bold">&#xa0;</span></p><p style="font-size:18pt; line-height:125%; margin:12pt 0pt 0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:18pt; font-weight:bold">&#xa0;</span></p><p style="font-size:18pt; line-height:125%; margin:12pt 0pt 0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:18pt; font-weight:bold">&#xa0;</span></p><p style="font-size:18pt; line-height:125%; margin:12pt 0pt 0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:18pt; font-weight:bold">&#xa0;</span></p><p style="font-size:18pt; line-height:125%; margin:12pt 0pt 0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:18pt; font-weight:bold">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><br style="page-break-before:always; clear:both" /></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:黑体; font-size:18pt; font-weight:bold">目  录</span></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:黑体; font-size:18pt; font-weight:bold">&#xa0;</span></p><p style="margin:6pt 0pt; orphans:0; widows:0"><a href="#_Toc532238396"><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">第</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">1</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">章 概述</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238397"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">1.1 Hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">简介</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238398"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">1.2 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">环境与工具</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238399"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">1.3 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">中间结果</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238400"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">1.4 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">本章小结</span></a></p><p style="margin:6pt 0pt; orphans:0; widows:0"><a href="#_Toc532238401"><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">第</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">2</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">章 预处理</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238402"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">2.1 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">预处理的概念与作用</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238403"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">2.2</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">在</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">Ubuntu</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">下预处理的命令</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238404"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">2.3 Hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的预处理结果解析</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238405"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">2.4 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">本章小结</span></a></p><p style="margin:6pt 0pt; orphans:0; widows:0"><a href="#_Toc532238406"><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">第</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">3</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">章 编译</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238407"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">3.1 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">编译的概念与作用</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238408"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">3.2 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">在</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">Ubuntu</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">下编译的命令</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238409"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">3.3 Hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的编译结果解析</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238410"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">3.4 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">本章小结</span></a></p><p style="margin:6pt 0pt; orphans:0; widows:0"><a href="#_Toc532238411"><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">第</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">4</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">章 汇编</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238412"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">4.1 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">汇编的概念与作用</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238413"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">4.2 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">在</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">Ubuntu</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">下汇编的命令</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238414"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">4.3 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">可重定位目标</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">elf</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">格式</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238415"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">4.4 Hello.o</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的结果解析</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238416"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">4.5 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">本章小结</span></a></p><p style="margin:6pt 0pt; orphans:0; widows:0"><a href="#_Toc532238417"><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">第</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">5</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">章 链接</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238418"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">5.1 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">链接的概念与作用</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238419"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">5.2 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">在</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">Ubuntu</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">下链接的命令</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238420"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">5.3 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">可执行目标文件</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的格式</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238421"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">5.4 hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的虚拟地址空间</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238422"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">5.5 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">链接的重定位过程分析</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238423"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">5.6 hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的执行流程</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238424"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">5.7 Hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的动态链接分析</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238425"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">5.8 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">本章小结</span></a></p><p style="margin:6pt 0pt; orphans:0; widows:0"><a href="#_Toc532238426"><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">第</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">6</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">章 </span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">进程管理</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238427"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">6.1 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">进程的概念与作用</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238428"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">6.2 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">简述壳</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">Shell-bash</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的作用与处理流程</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238429"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">6.3 Hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">fork</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">进程创建过程</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238430"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">6.4 Hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">execve</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">过程</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238431"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">6.5 Hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的进程执行</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238432"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">6.6 hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的异常与信号处理</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238433"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">6.7</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">本章小结</span></a></p><p style="margin:6pt 0pt; orphans:0; widows:0"><a href="#_Toc532238434"><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">第</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">7</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">章 </span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">的存储管理</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238435"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">7.1 hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的存储器地址空间</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238436"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">7.2 Intel</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">逻辑地址到线性地址的变换</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">-</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">段式管理</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238437"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">7.3 Hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的线性地址到物理地址的变换</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">-</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">页式管理</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238438"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">7.4 TLB</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">与四级页表支持下的</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">VA</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">到</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">PA</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的变换</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238439"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">7.5 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">三级</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">Cache</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">支持下的物理内存访问</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238440"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">7.6 hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">进程</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">fork</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">时的内存映射</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238441"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">7.7 hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">进程</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">execve</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">时的内存映射</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238442"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">7.8 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">缺页故障与缺页中断处理</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238443"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">7.9</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">动态存储分配管理</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238444"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">7.10</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">本章小结</span></a></p><p style="margin:6pt 0pt; orphans:0; widows:0"><a href="#_Toc532238445"><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">第</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">8</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">章 </span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">hello</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">的</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">IO</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">管理</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238446"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">8.1 Linux</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">IO</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">设备管理方法</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238447"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">8.2 </span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">简述</span><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">Unix IO</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">接口及其函数</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238448"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">8.3 printf</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的实现分析</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238449"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">8.4 getchar</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">的实现分析</span></a></p><p style="margin:0pt 0pt 0pt 12pt; orphans:0; widows:0"><a href="#_Toc532238450"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; font-variant:small-caps; text-decoration:underline">8.5</span><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-variant:small-caps; text-decoration:underline">本章小结</span></a></p><p style="margin:6pt 0pt; orphans:0; widows:0"><a href="#_Toc532238451"><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">结论</span></a></p><p style="margin:6pt 0pt; orphans:0; widows:0"><a href="#_Toc532238452"><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">附件</span></a></p><p style="margin:6pt 0pt; orphans:0; widows:0"><a href="#_Toc532238453"><span style="color:#0000ff; font-family:宋体; font-size:12pt; font-weight:bold; text-decoration:underline; text-transform:uppercase">参考文献</span></a></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:黑体; font-size:18pt; font-weight:bold">&#xa0;</span></p><h1 style="line-height:40pt; margin:20pt 0pt 10pt; orphans:0; text-align:center; widows:0"><a name="_Toc225579641"></a><a name="_Toc250450165"><br style="page-break-before:always; clear:both" /></a><a name="_Toc532238396"><span style="font-family:黑体; font-size:18pt; font-weight:bold">第1章 </span><span style="-aw-bookmark-end:_Toc225579641"></span><span style="-aw-bookmark-end:_Toc250450165"></span><span style="font-family:黑体; font-size:18pt; font-weight:bold">概述</span></a></h1><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc225579642"></a><a name="_Toc250450166"></a><a name="_Toc532238397"><span style="font-family:黑体; font-size:15pt">1.1 </span><span style="-aw-bookmark-end:_Toc225579642"></span><span style="-aw-bookmark-end:_Toc250450166"></span><span style="font-family:黑体; font-size:15pt">Hello简介</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">P2P</span><span style="font-family:宋体; font-size:12pt">：</span><span style="font-family:'Times New Roman'; font-size:12pt">Program to Process</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">在</span><span style="font-family:'Times New Roman'; font-size:12pt">linux</span><span style="font-family:宋体; font-size:12pt">中，</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.c</span><span style="font-family:宋体; font-size:12pt">经过</span><span style="font-family:'Times New Roman'; font-size:12pt">cpp</span><span style="font-family:宋体; font-size:12pt">的预处理、</span><span style="font-family:'Times New Roman'; font-size:12pt">ccl</span><span style="font-family:宋体; font-size:12pt">的编译、</span><span style="font-family:'Times New Roman'; font-size:12pt">as</span><span style="font-family:宋体; font-size:12pt">的汇编、</span><span style="font-family:'Times New Roman'; font-size:12pt">ld</span><span style="font-family:宋体; font-size:12pt">的链接最终成为可执行目标程序</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">，在</span><span style="font-family:'Times New Roman'; font-size:12pt">shell</span><span style="font-family:宋体; font-size:12pt">中键入启动命令后，</span><span style="font-family:'Times New Roman'; font-size:12pt">shell</span><span style="font-family:宋体; font-size:12pt">为其</span><span style="font-family:'Times New Roman'; font-size:12pt">fork</span><span style="font-family:宋体; font-size:12pt">，产生子进程，产生子进程后</span><span style="font-family:'Times New Roman'; font-size:12pt">shell</span><span style="font-family:宋体; font-size:12pt">为</span><span style="font-family:'Times New Roman'; font-size:12pt">hello execve</span><span style="font-family:宋体; font-size:12pt">，于是</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">便从</span><span style="font-family:'Times New Roman'; font-size:12pt">Program</span><span style="font-family:宋体; font-size:12pt">（个人理解为程序项目）变为</span><span style="font-family:'Times New Roman'; font-size:12pt">Process</span><span style="font-family:宋体; font-size:12pt">（进程），这便是</span><span style="font-family:'Times New Roman'; font-size:12pt">P2P</span><span style="font-family:宋体; font-size:12pt">的过程。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2.O2O</span><span style="font-family:宋体; font-size:12pt">：</span><span style="font-family:'Times New Roman'; font-size:12pt">Zero-0 to Zero-0</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">这里的</span><span style="font-family:'Times New Roman'; font-size:12pt">020</span><span style="font-family:宋体; font-size:12pt">应该指的是</span><span style="font-family:'Times New Roman'; font-size:12pt">Process</span><span style="font-family:宋体; font-size:12pt">在内存中</span><span style="font-family:'Times New Roman'; font-size:12pt">From Zero to Zero</span><span style="font-family:宋体; font-size:12pt">。产生子进程后</span><span style="font-family:'Times New Roman'; font-size:12pt">shell</span><span style="font-family:宋体; font-size:12pt">为</span><span style="font-family:'Times New Roman'; font-size:12pt">hello execve</span><span style="font-family:宋体; font-size:12pt">，映射虚拟内存，进入程序入口后程序开始载入物理内存，然后进入 </span><span style="font-family:'Times New Roman'; font-size:12pt">main</span><span style="font-family:宋体; font-size:12pt">函数执行目标代码，</span><span style="font-family:'Times New Roman'; font-size:12pt">CPU</span><span style="font-family:宋体; font-size:12pt">为运行的</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">分配时间片执行逻辑控制流。当程序运行结束后，</span><span style="font-family:'Times New Roman'; font-size:12pt">shell</span><span style="font-family:宋体; font-size:12pt">父进程负责回收</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">进程，内核删除相关数据结构，这便是</span><span style="font-family:'Times New Roman'; font-size:12pt">020</span><span style="font-family:宋体; font-size:12pt">的过程。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc225579643"></a><a name="_Toc250450167"></a><a name="_Toc532238398"><span style="font-family:黑体; font-size:15pt">1.2 </span><span style="-aw-bookmark-end:_Toc225579643"></span><span style="-aw-bookmark-end:_Toc250450167"></span><span style="font-family:黑体; font-size:15pt">环境与工具</span></a></h2><p style="margin:5pt 0pt"><a name="_Toc532238399"><span style="font-family:宋体; font-size:12pt">软件环境：</span><span style="font-family:'Times New Roman'; font-size:12pt">Windows10</span><span style="font-family:宋体; font-size:12pt">、</span><span style="font-family:'Times New Roman'; font-size:12pt">Ubuntu 19.04</span></a></p><p style="margin:5pt 0pt"><span style="font-family:宋体; font-size:12pt">硬件环境：</span><span style="font-family:'Times New Roman'; font-size:12pt">Core i7-</span><span style="font-family:'Times New Roman'; font-size:12pt">877</span><span style="font-family:'Times New Roman'; font-size:12pt">0U</span></p><p style="margin:5pt 0pt"><span style="font-family:宋体; font-size:12pt">开发和调试工具： </span><span style="font-family:'Times New Roman'; font-size:12pt">Codeblocks</span><span style="font-family:宋体; font-size:12pt">、</span><span style="font-family:'Times New Roman'; font-size:12pt">Visual Studio 201</span><span style="font-family:'Times New Roman'; font-size:12pt">7</span><span style="font-family:宋体; font-size:12pt">、</span><span style="font-family:'Times New Roman'; font-size:12pt">gdb</span><span style="font-family:宋体; font-size:12pt">、</span><span style="font-family:'Times New Roman'; font-size:12pt">gedit</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">1.3 中间结果</span><span style="-aw-bookmark-end:_Toc532238399"></span></h2><table cellspacing="0" cellpadding="0" style="border-collapse:collapse; margin-left:0pt"><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:宋体; font-size:12pt">文件名</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:宋体; font-size:12pt">作用</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">hello.c</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:宋体; font-size:12pt">源程序</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">hello.i</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:宋体; font-size:12pt">预处理文件</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">hello.s</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:宋体; font-size:12pt">根据</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.i</span><span style="font-family:宋体; font-size:12pt">编译得到的</span><span style="font-family:'Times New Roman'; font-size:12pt">.s</span><span style="font-family:宋体; font-size:12pt">文件</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">hello.o</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:宋体; font-size:12pt">可重定位目标程序</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">hello</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:宋体; font-size:12pt">连接后的可执行文件</span></p></td></tr></table><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238400"><span style="font-family:黑体; font-size:15pt">1.4 本章小结</span></a></h2><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">本章对hello进行了简单的介绍，分析了其P2P和020的过程，列出了本次任务的环境和工具，并且阐明了任务过程中出现的中间产物及其作用。</span></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:center; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">（第1章0.5分）</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><h1 style="line-height:40pt; margin:20pt 0pt 10pt; orphans:0; text-align:center; widows:0"><a name="_Toc225579646"></a><a name="_Toc250450171"><br style="page-break-before:always; clear:both" /></a><a name="_Toc532238401"><span style="font-family:黑体; font-size:18pt; font-weight:bold">第2章 </span><span style="-aw-bookmark-end:_Toc225579646"></span><span style="-aw-bookmark-end:_Toc250450171"></span><span style="font-family:黑体; font-size:18pt; font-weight:bold">预处理</span></a></h1><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc225579647"></a><a name="_Toc250450172"></a><a name="_Toc532238402"><span style="font-family:黑体; font-size:15pt">2.1</span><span style="-aw-bookmark-end:_Toc225579647"></span><span style="-aw-bookmark-end:_Toc250450172"></span><span style="font-family:黑体; font-size:15pt"> </span><span style="font-family:黑体; font-size:15pt">预处理的概念与作用</span></a></h2><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">预处理器(cpp)根据以#开头的命令，修改原始的C程序。比如hello.c中第6行的#include&lt;stdio.h&gt;命令高速预处理器读取系统头文件stdio.h的内容，并把它直接插入程序文本中。结果就得到了另一个C程序，通常是以.i作为文件拓展名</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238403"><span style="font-family:黑体; font-size:15pt">2.2在Ubuntu下预处理的命令</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">gcc -E hello.c -o hello.i</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.002.png" width="567" height="99" alt="TIM截图20200101142552" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238404"><span style="font-family:黑体; font-size:15pt">2.3 Hello的预处理结果解析</span></a></h2><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><a name="_Toc532238405"><span style="font-family:宋体; font-size:12pt">修改得到的C程序hello.i已经从原来hello.c的534个字节增加到63364个字节，并且增加到3110行。再用gedit打开hello.i，发现在main函数在文件的最后部分。</span></a></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">而在main函数之前，预处理器(cpp)读取头文件stdio.h 、stdlib.h 、和unistd.h中的内容，三个系统头文件依次展开。比如stdio.h的展开，打开usr/include/stdio.h发现了其中还含有#开头的宏定义等，预处理器会对此继续递归展开，最终的.i程序中没有#define，并且针对#开头的条件编译语句，cpp根据#if后面的条件决定需要编译的代码。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">&#xa0;</span></h2><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">2.4 本章小结</span><span style="-aw-bookmark-end:_Toc532238405"></span></h2><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">本章介绍了hello.c的预处理阶段，根据预处理命令得到了修改后的hello.i程序，并且对hello.i程序进行了预处理结果解析，理解了预处理器读取系统头文件中内容，并把它插入程序文本中的过程</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:center; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">（第2章0.5分）</span></p><h1 style="line-height:40pt; margin:20pt 0pt 10pt; orphans:0; text-align:center; widows:0"><br style="page-break-before:always; clear:both" /><a name="_Toc532238406"><span style="font-family:黑体; font-size:18pt; font-weight:bold">第3章 </span><span style="font-family:黑体; font-size:18pt; font-weight:bold">编译</span></a></h1><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238407"><span style="font-family:黑体; font-size:15pt">3.1 编译的概念与作用</span></a></h2><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><p style="font-size:12pt; line-height:135%; margin:0pt 0pt 6pt 24pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">在这个阶段，编译器首先要检查代码的规范性，是否有语法错误等，以确定代码的实际要做的工作，再检查无误后，编译器（</span><span style="font-family:'Times New Roman'; font-size:12pt">ccl</span><span style="font-family:宋体; font-size:12pt">）见文本文件</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.i</span><span style="font-family:宋体; font-size:12pt">翻译成文本文件</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.s</span><span style="font-family:宋体; font-size:12pt">，它包含一个汇编语言程序。该程序包含函数</span><span style="font-family:'Times New Roman'; font-size:12pt">main</span><span style="font-family:宋体; font-size:12pt">的定义，语句以一种文本格式描述了一条低级机器语言指令。汇编语言位不同高级语言的不同编译器提供了通用的输出语言。</span></p><p style="font-size:12pt; line-height:135%; margin:0pt 0pt 6pt 24pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238408"><span style="font-family:黑体; font-size:15pt">3.2 在Ubuntu下编译的命令</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">gcc -S hello.i -o hello.s</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.003.png" width="508" height="87" alt="编译" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238409"><span style="font-family:黑体; font-size:15pt">3.3 Hello的编译结果解析</span></a></h2><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">hello.s</span><span style="font-family:宋体; font-size:12pt">中的各种指令：</span></p><table cellspacing="0" cellpadding="0" style="border-collapse:collapse; margin-left:0pt"><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; vertical-align:baseline">.file</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:宋体; font-size:12pt">源文件名</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; vertical-align:baseline">.globl</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:宋体; font-size:12pt">全局变量</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; vertical-align:baseline">.data</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:宋体; font-size:12pt; vertical-align:baseline">数据段</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; vertical-align:baseline">.align</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:宋体; font-size:12pt; vertical-align:baseline">对齐</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; vertical-align:baseline">.type</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:宋体; font-size:12pt">指定是对象类型或是函数类型</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; vertical-align:baseline">.size</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:宋体; font-size:12pt; vertical-align:baseline">大小</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; vertical-align:baseline">.long</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:宋体; font-size:12pt; vertical-align:baseline">长整型</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; vertical-align:baseline">.section</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:宋体; font-size:12pt; vertical-align:baseline">节头表</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; vertical-align:baseline">.rodata</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:宋体; font-size:12pt; vertical-align:baseline">只读数据段</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; vertical-align:baseline">.string</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:宋体; font-size:12pt; vertical-align:baseline">字符串</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; vertical-align:baseline">.text</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24.9pt; widows:0"><span style="font-family:宋体; font-size:12pt; vertical-align:baseline">代码段</span></p></td></tr></table><ol type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; line-height:125%; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:12pt">数据：</span></li></ol><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">hello.s中C语言的数据类型有：局部变量，指针数组</span><span style="font-family:宋体; font-size:12pt">，</span><span style="font-family:宋体; font-size:12pt">无全局变量</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">int argc；argc是函数传入的第一个int型参数，存储在%edi中</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">int i；局部变量，通常保存在寄存器或是栈中。根据movl $0, -4(%rbp)操作可知i的数据类型占用了4字节的栈空间。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">argv[1]</span><span style="font-family:宋体; font-size:12pt">、</span><span style="font-family:宋体; font-size:12pt">argv[2]</span><span style="font-family:宋体; font-size:12pt">和argv[</span><span style="font-family:宋体; font-size:12pt">3</span><span style="font-family:宋体; font-size:12pt">]都声明在.rodata只能读数据段中，并且给出了字符串的编码</span></p><ol start="2" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; line-height:125%; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:12pt">赋值：</span><span style="font-family:'Times New Roman'; font-size:12pt">i</span><span style="font-family:宋体; font-size:12pt">在循环之前被赋值</span></li></ol><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.004.png" width="567" height="41" alt="i" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">在</span><span style="font-family:'Times New Roman'; font-size:12pt">main</span><span style="font-family:宋体; font-size:12pt">函数第</span><span style="font-family:'Times New Roman'; font-size:12pt">41</span><span style="font-family:宋体; font-size:12pt">行循环开始之前的第</span><span style="font-family:'Times New Roman'; font-size:12pt">14</span><span style="font-family:宋体; font-size:12pt">行，</span><span style="font-family:'Times New Roman'; font-size:12pt">i</span><span style="font-family:宋体; font-size:12pt">被存储到</span><span style="font-family:'Times New Roman'; font-size:12pt">%ebx</span><span style="font-family:宋体; font-size:12pt">中，赋值为</span><span style="font-family:'Times New Roman'; font-size:12pt">0</span></p><ol start="3" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; line-height:125%; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:12pt">类型转换</span></li></ol><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">这里涉及一处调用系统函数</span><span style="font-family:'Times New Roman'; font-size:12pt">atoi</span><span style="font-family:宋体; font-size:12pt">函数将</span><span style="font-family:'Times New Roman'; font-size:12pt">argv[3]</span><span style="font-family:宋体; font-size:12pt">转换成</span><span style="font-family:'Times New Roman'; font-size:12pt">int</span><span style="font-family:宋体; font-size:12pt">型的操作</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.005.png" width="567" height="75" alt="atoi" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><ol start="4" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; line-height:125%; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:12pt">算数操作</span></li></ol><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">这里有一处，通过不断增加</span><span style="font-family:'Times New Roman'; font-size:12pt">i</span><span style="font-family:宋体; font-size:12pt">的值，并与</span><span style="font-family:'Times New Roman'; font-size:12pt">7</span><span style="font-family:宋体; font-size:12pt">不断比较的例子</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.006.png" width="567" height="86" alt="算数" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><ol start="5" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; line-height:125%; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:12pt">逻辑操作</span><span style="font-family:'Times New Roman'; font-size:12pt">/</span><span style="font-family:宋体; font-size:12pt">位操作</span></li></ol><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">如果</span><span style="font-family:'Times New Roman'; font-size:12pt">cmp</span><span style="font-family:宋体; font-size:12pt">按位比较算位操作</span><span style="font-family:'Times New Roman'; font-size:12pt">/</span><span style="font-family:宋体; font-size:12pt">逻辑操作，那么在</span><span style="font-family:'Times New Roman'; font-size:12pt">4</span><span style="font-family:宋体; font-size:12pt">的图中已经有了，并且已经加以说明了，除此之外没有位操作</span></p><ol start="6" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; line-height:125%; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:12pt">关系操作</span></li></ol><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">第一处：看</span><span style="font-family:'Times New Roman'; font-size:12pt">argc</span><span style="font-family:宋体; font-size:12pt">是否是</span><span style="font-family:'Times New Roman'; font-size:12pt">4</span><span style="font-family:宋体; font-size:12pt">而进行的关系操作</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.007.png" width="567" height="68" alt="if1" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">第二处：在</span><span style="font-family:'Times New Roman'; font-size:12pt">for</span><span style="font-family:宋体; font-size:12pt">循环中判断</span><span style="font-family:'Times New Roman'; font-size:12pt">i</span><span style="font-family:宋体; font-size:12pt">是否到达临界条件而设计的</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.008.png" width="567" height="86" alt="算数" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><ol start="7" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; line-height:125%; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:12pt">数组</span><span style="font-family:'Times New Roman'; font-size:12pt">/</span><span style="font-family:宋体; font-size:12pt">指针</span><span style="font-family:'Times New Roman'; font-size:12pt">/</span><span style="font-family:宋体; font-size:12pt">结构操作</span></li></ol><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">这里有将参数导入</span><span style="font-family:'Times New Roman'; font-size:12pt">printf</span><span style="font-family:宋体; font-size:12pt">函数和</span><span style="font-family:'Times New Roman'; font-size:12pt">atoi</span><span style="font-family:宋体; font-size:12pt">函数的部分，是将</span><span style="font-family:'Times New Roman'; font-size:12pt">argv</span><span style="font-family:宋体; font-size:12pt">字符串数组导入这两个函数的过程，如下图：</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.009.png" width="567" height="201" alt="数组" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><ol start="8" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; line-height:125%; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:12pt">控制转移</span></li></ol><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">判断</span><span style="font-family:'Times New Roman'; font-size:12pt">argc</span><span style="font-family:宋体; font-size:12pt">是否为</span><span style="font-family:'Times New Roman'; font-size:12pt">4</span><span style="font-family:宋体; font-size:12pt">而进行的控制转移：</span><span style="font-family:'Times New Roman'; font-size:12pt">jne</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.010.png" width="567" height="68" alt="if1" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">判断</span><span style="font-family:'Times New Roman'; font-size:12pt">i</span><span style="font-family:宋体; font-size:12pt">是否小于等于</span><span style="font-family:'Times New Roman'; font-size:12pt">7</span><span style="font-family:宋体; font-size:12pt">而进行的控制转移：</span><span style="font-family:'Times New Roman'; font-size:12pt">jle</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.008.png" width="567" height="86" alt="算数" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">还有一处：</span><span style="font-family:'Times New Roman'; font-size:12pt">jmp</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">这里是如果判断</span><span style="font-family:'Times New Roman'; font-size:12pt">argc</span><span style="font-family:宋体; font-size:12pt">是</span><span style="font-family:'Times New Roman'; font-size:12pt">4</span><span style="font-family:宋体; font-size:12pt">，那么不必进行下面的部分代码，直接跳到</span><span style="font-family:'Times New Roman'; font-size:12pt">for</span><span style="font-family:宋体; font-size:12pt">循环即可</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.011.png" width="567" height="92" alt="条" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><ol start="9" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; line-height:125%; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font:7.0pt 'Times New Roman'"> </span><span style="font-family:宋体; font-size:12pt">函数操作</span></li></ol><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1.main</span><span style="font-family:宋体; font-size:12pt">函数：</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">参数传递：传入参数</span><span style="font-family:'Times New Roman'; font-size:12pt">argc</span><span style="font-family:宋体; font-size:12pt">和</span><span style="font-family:'Times New Roman'; font-size:12pt">argv</span><span style="font-family:宋体; font-size:12pt">，分别用寄存器</span><span style="font-family:'Times New Roman'; font-size:12pt">%rdi</span><span style="font-family:宋体; font-size:12pt">和</span><span style="font-family:'Times New Roman'; font-size:12pt">%rsi</span><span style="font-family:宋体; font-size:12pt">存储。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">函数调用：被系统启动函数调用。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">函数返回：设置</span><span style="font-family:'Times New Roman'; font-size:12pt">%eax</span><span style="font-family:宋体; font-size:12pt">为</span><span style="font-family:'Times New Roman'; font-size:12pt">0</span><span style="font-family:宋体; font-size:12pt">并且返回，对应</span><span style="font-family:'Times New Roman'; font-size:12pt">return 0 </span><span style="font-family:宋体; font-size:12pt">。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.012.png" width="567" height="537" alt="main" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2.printf</span><span style="font-family:宋体; font-size:12pt">函数：</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">参数传递：</span><span style="font-family:'Times New Roman'; font-size:12pt">call puts</span><span style="font-family:宋体; font-size:12pt">时只传入了字符串参数首地址；</span><span style="font-family:'Times New Roman'; font-size:12pt">for</span><span style="font-family:宋体; font-size:12pt">循环中</span><span style="font-family:'Times New Roman'; font-size:12pt">call printf</span><span style="font-family:宋体; font-size:12pt">时传入了 </span><span style="font-family:'Times New Roman'; font-size:12pt">argv[1]</span><span style="font-family:宋体; font-size:12pt">和</span><span style="font-family:'Times New Roman'; font-size:12pt">argc[2]</span><span style="font-family:宋体; font-size:12pt">的地址。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">函数调用：</span><span style="font-family:'Times New Roman'; font-size:12pt">for</span><span style="font-family:宋体; font-size:12pt">循环中被调用</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.013.png" width="567" height="51" alt="printf" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">3.exit</span><span style="font-family:宋体; font-size:12pt">函数：</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">参数传递：传入的参数为</span><span style="font-family:'Times New Roman'; font-size:12pt">1</span><span style="font-family:宋体; font-size:12pt">，再执行退出命令</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">函数调用：</span><span style="font-family:'Times New Roman'; font-size:12pt">if</span><span style="font-family:宋体; font-size:12pt">判断条件满足后被调用</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.014.png" width="548" height="52" alt="exit" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">4.sleep</span><span style="font-family:宋体; font-size:12pt">函数：</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">参数传递：传入参数</span><span style="font-family:'Times New Roman'; font-size:12pt">atoi</span><span style="font-family:宋体; font-size:12pt">函数返回值，</span><span style="font-family:宋体; font-size:12pt">传递控制</span><span style="font-family:'Times New Roman'; font-size:12pt">call sleep</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">函数调用：</span><span style="font-family:'Times New Roman'; font-size:12pt">for</span><span style="font-family:宋体; font-size:12pt">循环下被调用</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.015.png" width="567" height="52" alt="sleep" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">5.getchar</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">传递控制：</span><span style="font-family:'Times New Roman'; font-size:12pt">call getchar</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">函数调用：在</span><span style="font-family:'Times New Roman'; font-size:12pt">main</span><span style="font-family:宋体; font-size:12pt">中被调用</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.016.png" width="526" height="47" alt="getchar" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><ol start="6" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; line-height:125%; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0;&#xa0;&#xa0; </span><span style="font-family:'Times New Roman'; font-size:12pt">atoi</span><span style="font-family:宋体; font-size:12pt">函数：</span></li></ol><p style="font-size:12pt; line-height:125%; margin:0pt 0pt 0pt 21pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">参数传递：</span><span style="font-family:'Times New Roman'; font-size:12pt">argv[3]</span></p><p style="font-size:12pt; line-height:125%; margin:0pt 0pt 0pt 21pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">函数调用：在</span><span style="font-family:'Times New Roman'; font-size:12pt">main</span><span style="font-family:宋体; font-size:12pt">函数中被调用</span></p><p style="font-size:12pt; line-height:125%; margin:0pt 0pt 0pt 21pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.017.png" width="567" height="47" alt="鳌头" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238410"><span style="font-family:黑体; font-size:15pt">3.4 本章小结</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">本章我们主要介绍了编译器是如何将文本编译成汇编代码的。可以发现，编译器并不是死板的按照我们原来文本的顺序，逐条语句进行翻译下来的。编译器在编译的过程中，不近会对我们的代码做一些隐式的优化，而且会将原来代码中用到的跳转，循环等操作操作用控制转移等方法进行解析。最后生成我们需要的</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.s</span><span style="font-family:宋体; font-size:12pt">文件。</span></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">（第</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">3</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">章</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">2</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">分）</span></p><h1 style="line-height:40pt; margin:20pt 0pt 10pt; orphans:0; text-align:center; widows:0"><br style="page-break-before:always; clear:both" /><a name="_Toc532238411"><span style="font-family:黑体; font-size:18pt; font-weight:bold">第4章 </span><span style="font-family:黑体; font-size:18pt; font-weight:bold">汇编</span></a></h1><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238412"><span style="font-family:黑体; font-size:15pt">4.1 汇编的概念与作用</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">概念：</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">汇编器（as）将hello.s文件翻译成机器语言指令，把这些指令打包成一种叫做可重定位目标程序的格式，并将结果保存在hello.o中。这里的hello.o是一个二进制文件。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">作用：</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">我们知道，汇编代码也只是我们人可以看懂的代码，而机器并不能读懂，真正机器可以读懂并执行的是机器代码，也就是二进制代码。汇编的作用就是将我们之前再hello.s中保存的汇编代码翻译成可以攻机器执行的二进制代码，这样机器就可以根据这些01代码，真正的开始执行我们写的程序了。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238413"><span style="font-family:黑体; font-size:15pt">4.2 在Ubuntu下汇编的命令</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">gcc -c hello.s -o hello.o</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.018.png" width="459" height="61" alt="汇编" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238414"><span style="font-family:黑体; font-size:15pt">4.3 可重定位目标elf</span></a><span style="font-family:黑体; font-size:15pt">格式</span></h2><ol type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:宋体; font-size:12pt; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font-family:宋体; font-size:12pt">ELF头：</span><br /><span style="font-family:宋体; font-size:12pt">ELF头以一个16字节的序列开始，这个序列描述了生成该文件的系统的字的大小和字节顺序。ELF头剩下的部分包含帮助链接器语法分析和解释目标文件的信息，其中包括ELF头的大小、目标文件的类型、机器类型、节头部表的文件偏移，节头部表中条目的大小和数量等。</span></li></ol><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.019.png" width="353" height="228" alt="elf头" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><ol start="2" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:宋体; font-size:12pt; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font-family:宋体; font-size:12pt">节头表</span><br /><span style="font-family:宋体; font-size:12pt">记录了每个节的名称、类型、属性（读写权限）、在ELF文件中所占的长度、对齐方式和偏移量</span></li></ol><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.020.png" width="493" height="441" alt="elf" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><ol start="3" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:宋体; font-size:12pt; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:0pt; widows:0"><span style="font-family:宋体; font-size:12pt">重定位节</span><span style="font-family:宋体; font-size:12pt">（</span><span style="font-family:宋体; font-size:12pt">如下图</span><span style="font-family:宋体; font-size:12pt">）</span><br /><span style="font-family:宋体; font-size:12pt">重定位条目告诉链接器在将目标文件合并成可执行文件时如何修改这个引用。如图，偏移量是需要被修改的引用的节偏移，符号标识被修改引用应该指向的符号。类型告知链接器如何修改新的引用，加数是一个有符号常数，一些类型的重定位要用它对被修改引用的值做偏移调整。</span></li></ol><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">r_offset:</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">此成员指定应用重定位操作的位置。不同的目标文件对于此成员的解释会稍有不同。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">r_info:</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">此成员指定必须对其进行重定位的符号表索引以及要应用的重定位类型。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">重定位类型特定于处理器。重定位项的重定位类型或符号表索引是将 ELF32_R_TYPE 或 ELF32_R_SYM 分别应用于项的r_info成员所得的结果。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">r_addend:</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">此成员指定常量加数，用于计算将存储在可重定位字段中的值。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">重定位类型：</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">R_X86_64_PC3：重定位一个使用32位PC相对地址的引用。在指令中编码的32位值加上PC的当前运行时值，得到有效地址。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">R_X86_64_32：重定位一个使用32位PC绝对地址的引用。直接使用在指令中编码的32位值作为有效地址。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.021.png" width="567" height="232" alt="重定位节" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">4.符号表</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">它存放在程序中定义和引用的函数和全局变量的信息,.symtab符号表不包含局部变量的条目。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.022.png" width="567" height="306" alt="符号表" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238415"><span style="font-family:黑体; font-size:15pt">4.4 Hello.o的结果解析</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">Objdump</span><span style="font-family:宋体; font-size:12pt">后的汇编代码：</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.023.png" width="567" height="476" alt="main22" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.024.png" width="476" height="200" alt="main33" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">通过与原文件对比后发现：</span></p><p style="margin:5pt 0pt"><span style="font-family:'Times New Roman'; font-size:12pt">1</span><span style="font-family:宋体; font-size:12pt">）过程调用的符号，被替换为相对寻址。</span></p><p style="margin:5pt 0pt"><span style="font-family:'Times New Roman'; font-size:12pt">2</span><span style="font-family:宋体; font-size:12pt">）条件转移中的</span><span style="font-family:'Times New Roman'; font-size:12pt">.L</span><span style="font-family:宋体; font-size:12pt">标记被准确的相对</span><span style="font-family:'Times New Roman'; font-size:12pt">main</span><span style="font-family:宋体; font-size:12pt">的开始的偏移所代替。</span></p><p style="margin:5pt 0pt"><span style="font-family:'Times New Roman'; font-size:12pt">3</span><span style="font-family:宋体; font-size:12pt">）全局变量的符号，被替换为相对寻址。</span></p><p style="margin:5pt 0pt"><span style="font-family:宋体; font-size:12pt">值得注意的是，由于还未进行链接，上述的相对寻址全都暂时被</span><span style="font-family:'Times New Roman'; font-size:12pt">0x0(%rip)</span><span style="font-family:宋体; font-size:12pt">代替。</span></p><p style="margin:5pt 0pt"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span><span style="font-family:宋体; font-size:12pt"> 此外，可以发现，</span><span style="font-family:'Times New Roman'; font-size:12pt">.text</span><span style="font-family:宋体; font-size:12pt">中的各个汇编指令的作用效果没有太大变化。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">（第</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">4</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">章</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">1</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">分）</span></p><h1 style="line-height:40pt; margin:20pt 0pt 10pt; orphans:0; text-align:center; widows:0"><br style="page-break-before:always; clear:both" /><a name="_Toc532238417"><span style="font-family:黑体; font-size:18pt; font-weight:bold">第</span><span style="font-family:黑体; font-size:18pt; font-weight:bold">5</span><span style="font-family:黑体; font-size:18pt; font-weight:bold">章 </span><span style="font-family:黑体; font-size:18pt; font-weight:bold">链接</span></a></h1><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238418"><span style="font-family:黑体; font-size:15pt">5.1 链接的概念与作用</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">定义</span><a name="_Toc532238419"><span style="font-family:宋体; font-size:12pt">：</span></a></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">链接是通过链接器（ld）将各种代码和数据片断收集并组合成一个单一文件的过程。这个文件可以被加载（复制）到内存并执行。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">作用：</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">因为有了链接这个概念的存在，所以我们的代码才回变得比较方便和简洁，同时可移植性强，模块化程度比较高。因为链接的过程可以使我们将程序封装成很多的模块，我们在变成的过程中只用写主程序的部分，对于其他的部分我们有些可以直接调用模块，就像C中的printf一样。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">作为编译的多后一步链接，就是处理当前程序调用其他模块的操作，将该调用的模块中的代码组合到相应的可执行文件中去。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">5.2 在Ubuntu下链接的命令</span><span style="-aw-bookmark-end:_Toc532238419"></span></h2><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; widows:0"><a name="_Toc532238420"><span style="font-family:黑体; font-size:12pt">ld -dynamic-linker</span><span style="font-family:黑体; font-size:12pt"> </span><span style="font-family:黑体; font-size:12pt">/lib64/ld-linux-x86-64.so.2</span><span style="font-family:黑体; font-size:12pt"> </span><span style="font-family:黑体; font-size:12pt">/usr/lib/x86_64-linux-gnu/crt1.o /usr/lib/x86_64-linux-gnu/crti.o /usr/lib/x86_64-linux-gnu/crtn.o hello.o -lc -z relro -o hello</span></a></h2><h2 style="font-weight:normal; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.025.png" width="567" height="53" alt="链接" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></h2><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">5.3 可执行目标文件hello的格式</span><span style="-aw-bookmark-end:_Toc532238420"></span></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">    </span><img src="56ddce64-b647-4733-ad58-b72a90290a85.026.png" width="567" height="430" alt="helloelf1" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /><img src="56ddce64-b647-4733-ad58-b72a90290a85.027.png" width="567" height="353" alt="helloelf2" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">图中</span><span style="font-family:宋体; font-size:12pt">保存了可执行文件</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">中的各个节的信息。可以看到</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">文件中的节的数目比</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.o</span><span style="font-family:宋体; font-size:12pt">中多了很多，说明在链接过后有很多文件有添加了进来。下面列出每一节中各个信息条目的含义：</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">       名称和大小这个条目中存储了每一个节的名称和这个节在重定位文件种所占的大小。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">       地址这个条目中，保存了各个节在重定位文件中的具体位置也就是地址。     偏移量这一栏中保存的是这个节在程序里面的地址的偏移量，也就是相对地址。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238421"><span style="font-family:黑体; font-size:15pt">5.4 hello的虚拟地址空间</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1.</span><span style="font-family:宋体; font-size:12pt">连接后的</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">属于</span><span style="font-family:'Times New Roman'; font-size:12pt">elf</span><span style="font-family:宋体; font-size:12pt">可执行目标文件，所包含的各类信息如下：</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.028.png" width="567" height="361" alt="elf头after" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2.</span><span style="font-family:宋体; font-size:12pt">虚拟地址空间各段信息：</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">（</span><span style="font-family:'Times New Roman'; font-size:12pt">1</span><span style="font-family:宋体; font-size:12pt">）</span><span style="font-family:'Times New Roman'; font-size:12pt">.PDHR:</span><span style="font-family:宋体; font-size:12pt">起始位置为</span><span style="font-family:'Times New Roman'; font-size:12pt">0x400040,</span><span style="font-family:宋体; font-size:12pt">大小为</span><span style="font-family:'Times New Roman'; font-size:12pt">0x1c0</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">（</span><span style="font-family:'Times New Roman'; font-size:12pt">2</span><span style="font-family:宋体; font-size:12pt">）</span><span style="font-family:'Times New Roman'; font-size:12pt">.INTERP:</span><span style="font-family:宋体; font-size:12pt">起始位置为</span><span style="font-family:'Times New Roman'; font-size:12pt">0x400200,</span><span style="font-family:宋体; font-size:12pt">大小为</span><span style="font-family:'Times New Roman'; font-size:12pt">0x1c</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">（</span><span style="font-family:'Times New Roman'; font-size:12pt">3</span><span style="font-family:宋体; font-size:12pt">）</span><span style="font-family:'Times New Roman'; font-size:12pt">.LOAD</span><span style="font-family:宋体; font-size:12pt">：起始位置为</span><span style="font-family:'Times New Roman'; font-size:12pt">0x400000</span><span style="font-family:宋体; font-size:12pt">，大小为</span><span style="font-family:'Times New Roman'; font-size:12pt">0x81c</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">（</span><span style="font-family:'Times New Roman'; font-size:12pt">4</span><span style="font-family:宋体; font-size:12pt">）</span><span style="font-family:'Times New Roman'; font-size:12pt">.LOAD</span><span style="font-family:宋体; font-size:12pt">：起始位置为</span><span style="font-family:'Times New Roman'; font-size:12pt">0x600e00,</span><span style="font-family:宋体; font-size:12pt">大小为</span><span style="font-family:'Times New Roman'; font-size:12pt">0x258</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238422"><span style="font-family:黑体; font-size:15pt">5.5 链接的重定位过程分析</span></a></h2><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1.hello</span><span style="font-family:宋体; font-size:12pt">中增加了许多节和被调用的函数。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2.</span><span style="font-family:宋体; font-size:12pt">对</span><span style="font-family:'Times New Roman'; font-size:12pt">rodata</span><span style="font-family:宋体; font-size:12pt">的引用：在</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.o</span><span style="font-family:宋体; font-size:12pt">的反汇编文件中对</span><span style="font-family:'Times New Roman'; font-size:12pt">printf</span><span style="font-family:宋体; font-size:12pt">参数字符串的引用使用全</span><span style="font-family:'Times New Roman'; font-size:12pt">0</span><span style="font-family:宋体; font-size:12pt">替代。在</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">中则使用确定地址，这是因为链接后全局变量的地址能够确定。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">3.hello.o</span><span style="font-family:宋体; font-size:12pt">中</span><span style="font-family:'Times New Roman'; font-size:12pt">main </span><span style="font-family:宋体; font-size:12pt">的地址从</span><span style="font-family:'Times New Roman'; font-size:12pt">0</span><span style="font-family:宋体; font-size:12pt">开始，</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">中</span><span style="font-family:'Times New Roman'; font-size:12pt">main</span><span style="font-family:宋体; font-size:12pt">的地址不再是</span><span style="font-family:'Times New Roman'; font-size:12pt">0.</span><span style="font-family:宋体; font-size:12pt">库函数的代码都链接到了程序中。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">Hello.o</span><span style="font-family:宋体; font-size:12pt">的反汇编：</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.029.png" width="444" height="278" alt="hello点o的反汇编" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">Hello</span><span style="font-family:宋体; font-size:12pt">的反汇编：</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.030.png" width="497" height="235" alt="hello的反汇编" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">Hello.o</span><span style="font-family:宋体; font-size:12pt">中空白的函数处全部都在可执行文件</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">中有了填补</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238423"><span style="font-family:黑体; font-size:15pt">5.6 hello的执行流程</span></a></h2><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">（</span><span style="font-family:宋体; font-size:12pt; font-style:italic">以下格式自行编排，编辑时删除</span><span style="font-family:宋体; font-size:12pt">）</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">使用</span><span style="font-family:'Times New Roman'; font-size:12pt">edb</span><span style="font-family:宋体; font-size:12pt">执行</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">，说明从加载</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">到</span><span style="font-family:'Times New Roman'; font-size:12pt">_start</span><span style="font-family:宋体; font-size:12pt">，到</span><span style="font-family:'Times New Roman'; font-size:12pt">call main,</span><span style="font-family:宋体; font-size:12pt">以及程序终止的所有过程。请列出其调用与跳转的各个子程序名或程序地址。</span></p><table cellspacing="0" cellpadding="0" style="border-collapse:collapse; margin-left:0pt"><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:宋体; font-size:12pt">程序名称</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:宋体; font-size:12pt">程序地址</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">ld-2.27.so!_dl_start</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x7fe7a8177030</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">ld-2.27.so!_dl_init</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x7fe7a81859e0</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">hello!_start</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x400500</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">libc-2.27.so!_libc_start_main</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x7fe7a7f98a80</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">-libc-2.27.so!_cxa_atexit</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x7fe7a7f9ac43</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">-libc-2.27.so!_libc_csu_init</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x4005c0</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">hello!_init</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x400488</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">libc-2.27.so!_setjmp</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x7fe7a7884c10</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">-libc-2.27.so!_sigsetjmp</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x7fe7a7884b70</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">--libc-2.27.so!_sigjmp_save</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x7fe7a7884bd0</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">hello!main</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x400532</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">hello!puts@plt</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x4004b0</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">hello!puts@plt</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x4004e0</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">*hello!printf@plt</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">—</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">*hello!sleep@plt</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">—</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">*hello!getchar@plt</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">—</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">ld-2.27.so!_dl_runtime_resolove_xsave</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x7fe7a784e680</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">-ld-2.27.so!_dl_fixup</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x7fe7a7846df0</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">--ld-2.27.so!_dl_lookup_symbol_x</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x7fe7a78420b0</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">libc-2.27.so!exit</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; vertical-align:top; width:169.05pt"><p style="margin:5pt 0pt; text-align:center"><span style="font-family:'Times New Roman'; font-size:12pt">0x7fe7a7889128</span></p></td></tr></table><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238424"><span style="font-family:黑体; font-size:15pt">5.7 Hello的动态链接分析</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">程序调用一个由共享库定义的函数时，编译器没有办法预测这个函数的运行时地址，因为定义它的共享模块在运行时可以加载到任意位置。</span><span style="font-family:'Times New Roman'; font-size:12pt">GNU</span><span style="font-family:宋体; font-size:12pt">编译系统使用延迟绑定的技术解决这个问题，将过程地址的延迟绑定推迟到第一次调用该过程时。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">延迟绑定要用到全局偏移量表（</span><span style="font-family:'Times New Roman'; font-size:12pt">GOT</span><span style="font-family:宋体; font-size:12pt">）和过程链接表（</span><span style="font-family:'Times New Roman'; font-size:12pt">PLT</span><span style="font-family:宋体; font-size:12pt">）两个数据结构。如果一个目标模块调用定义在共享库中的任何函数，那么它就有自己的</span><span style="font-family:'Times New Roman'; font-size:12pt">GOT</span><span style="font-family:宋体; font-size:12pt">和</span><span style="font-family:'Times New Roman'; font-size:12pt">PLT</span><span style="font-family:宋体; font-size:12pt">。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">PLT</span><span style="font-family:宋体; font-size:12pt">：</span><span style="font-family:'Times New Roman'; font-size:12pt">PLT</span><span style="font-family:宋体; font-size:12pt">是一个数组，其中每个条目是</span><span style="font-family:'Times New Roman'; font-size:12pt">16</span><span style="font-family:宋体; font-size:12pt">字节代码。</span><span style="font-family:'Times New Roman'; font-size:12pt">PLT[0]</span><span style="font-family:宋体; font-size:12pt">是一个特殊条目，跳转到动态链接器中。每个条目都负责调用一个具体的函数。</span><span style="font-family:'Times New Roman'; font-size:12pt">PLT[[1]]</span><span style="font-family:宋体; font-size:12pt">调用系统启动函数 （</span><span style="font-family:'Times New Roman'; font-size:12pt">__libc_start_main</span><span style="font-family:宋体; font-size:12pt">）。从</span><span style="font-family:'Times New Roman'; font-size:12pt">PLT[[2]]</span><span style="font-family:宋体; font-size:12pt">开始的条目调用用户代码调用的函数。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">GOT</span><span style="font-family:宋体; font-size:12pt">：</span><span style="font-family:'Times New Roman'; font-size:12pt">GOT</span><span style="font-family:宋体; font-size:12pt">是一个数组，其中每个条目是</span><span style="font-family:'Times New Roman'; font-size:12pt">8</span><span style="font-family:宋体; font-size:12pt">字节地址。和</span><span style="font-family:'Times New Roman'; font-size:12pt">PLT</span><span style="font-family:宋体; font-size:12pt">联合使用时，</span><span style="font-family:'Times New Roman'; font-size:12pt">GOT[0]</span><span style="font-family:宋体; font-size:12pt">和</span><span style="font-family:'Times New Roman'; font-size:12pt">GOT[[1]]</span><span style="font-family:宋体; font-size:12pt">包含动态链接器在解析函数地址时会使用的信息。</span><span style="font-family:'Times New Roman'; font-size:12pt">GOT[[2]]</span><span style="font-family:宋体; font-size:12pt">是动态链接器在</span><span style="font-family:'Times New Roman'; font-size:12pt">ld-linux.so</span><span style="font-family:宋体; font-size:12pt">模块中的入口点。其余的每个条目对应于一个被调用的函数，其地址需要在运行时被解析。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238425"><span style="font-family:黑体; font-size:15pt">5.8 本章小结</span></a></h2><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:宋体; font-size:12pt">链接的过程，是将原来的只保存了你写的函数的代码与代码用所用的库函数合并的一个过程。在这个过程中链接器会为每个符号、函数等信息重新分配虚拟内存地址，方法就是用每个</span><span style="font-family:'Times New Roman'; font-size:12pt">.o</span><span style="font-family:宋体; font-size:12pt">文件中的重定位节与其它的节想配合，算出正确的地址。同时，将你会用到的库函数加载（复制）到可执行文件中。这些信息一同构成了一个完整的计算机可以运行的文件。链接让我们的程序做到了很好的模块化，我们只需要写我们的主要代码，对于读入、</span><span style="font-family:'Times New Roman'; font-size:12pt">IO</span><span style="font-family:宋体; font-size:12pt">等操作，可以直接与封装的模块相链接，这样大大的简化了代码的书写难度。</span></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">（第</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">5</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">章</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">1</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">分）</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><h1 style="line-height:40pt; margin:20pt 0pt 10pt; orphans:0; text-align:center; widows:0"><br style="page-break-before:always; clear:both" /><a name="_Toc532238426"><span style="font-family:黑体; font-size:18pt; font-weight:bold">第</span><span style="font-family:黑体; font-size:18pt; font-weight:bold">6</span><span style="font-family:黑体; font-size:18pt; font-weight:bold">章 </span><span style="font-family:黑体; font-size:18pt; font-weight:bold">hello进程管理</span></a></h1><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238427"><span style="font-family:黑体; font-size:15pt">6.1 进程的概念与作用</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238428"><span style="font-family:宋体; font-size:12pt">进程是一个执行中程序的实例。是系统进行资源分配和调度的基本单位，是操作系统结构的基础。</span></a></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">作用：进程的概念为我们提供这样一种假象，就好像我们的程序是系统中当前运行的唯一程序一样，我们的程序好像是独占地使用处理器和内存，处理器好像是无间断地一条接一条地执行我们程序中的指令，我们程序中的代码和数据好像是系统内存中唯一的对象。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">6.2 简述壳Shell-bash的作用与处理流程</span><span style="-aw-bookmark-end:_Toc532238428"></span></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238429"><span style="font-family:'Times New Roman'; font-size:12pt">Shell</span><span style="font-family:宋体; font-size:12pt">俗称壳，是指“为使用者提供操作界面”的软件（命令解析器）。它接收用户命令，然后调用相应的应用程序。</span></a></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1.</span><span style="font-family:宋体; font-size:12pt">功能：命令解释。</span><span style="font-family:'Times New Roman'; font-size:12pt">Linux</span><span style="font-family:宋体; font-size:12pt">系统中的所有可执行文件都可以作为</span><span style="font-family:'Times New Roman'; font-size:12pt">Shell</span><span style="font-family:宋体; font-size:12pt">命令来执行。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2.</span><span style="font-family:宋体; font-size:12pt">处理流程：</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1</span><span style="font-family:宋体; font-size:12pt">）当用户提交了一个命令后，</span><span style="font-family:'Times New Roman'; font-size:12pt">Shell</span><span style="font-family:宋体; font-size:12pt">首先判断它是否为内置命令，如果是就通过</span><span style="font-family:'Times New Roman'; font-size:12pt">Shell</span><span style="font-family:宋体; font-size:12pt">内部的解释器将其解释为系统功能调用并转交给内核执行。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2</span><span style="font-family:宋体; font-size:12pt">）若是外部命令或应用程序就试图在硬盘中查找该命令并将其调入内存，再将其解释为系统功能调用并转交给内核执行。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">6.3 Hello的fork进程创建过程</span><span style="-aw-bookmark-end:_Toc532238429"></span></h2><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">在终端中输入</span><span style="font-family:'Times New Roman'; font-size:12pt">./hello </span><span style="font-family:宋体; font-size:12pt">学号 姓名，</span><span style="font-family:'Times New Roman'; font-size:12pt">shell</span><span style="font-family:宋体; font-size:12pt">判断它不是内置命令，于是会加载并运行当前目录下的可执行文件</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.</span><span style="font-family:宋体; font-size:12pt">此时</span><span style="font-family:'Times New Roman'; font-size:12pt">shell</span><span style="font-family:宋体; font-size:12pt">通过</span><span style="font-family:'Times New Roman'; font-size:12pt">fork</span><span style="font-family:宋体; font-size:12pt">创建一个新的子进程。新创建的子进程几乎但不完全与父进程相同。子进程得到与父进程用户级虚拟地址空间相同的（但是独立的）一份副本，包括代码和数据段、堆、共享库和用户栈。子进程还获得与父进程任何打开文件描述符相同的副本，这就意味着当父进程调用</span><span style="font-family:'Times New Roman'; font-size:12pt">fork</span><span style="font-family:宋体; font-size:12pt">时，子进程可以读写父进程中打开的任何文件。子进程与父进程有不同的</span><span style="font-family:'Times New Roman'; font-size:12pt">pid</span><span style="font-family:宋体; font-size:12pt">。</span><span style="font-family:'Times New Roman'; font-size:12pt">fork</span><span style="font-family:宋体; font-size:12pt">被调用一次，返回两次。在父进程中</span><span style="font-family:'Times New Roman'; font-size:12pt">fork</span><span style="font-family:宋体; font-size:12pt">返回子进程的</span><span style="font-family:'Times New Roman'; font-size:12pt">pid</span><span style="font-family:宋体; font-size:12pt">，在子进程中</span><span style="font-family:'Times New Roman'; font-size:12pt">fork</span><span style="font-family:宋体; font-size:12pt">返回</span><span style="font-family:'Times New Roman'; font-size:12pt">0.</span><span style="font-family:宋体; font-size:12pt">父进程与子进程是并发运行的独立进程。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238430"><span style="font-family:黑体; font-size:15pt">6.4 Hello的execve过程</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">execve</span><span style="font-family:宋体; font-size:12pt">函数在新创建的子进程的上下文中加载并运行</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">程序。</span><span style="font-family:'Times New Roman'; font-size:12pt">execve</span><span style="font-family:宋体; font-size:12pt">函数加载并运行可执行目标文件</span><span style="font-family:'Times New Roman'; font-size:12pt">filename</span><span style="font-family:宋体; font-size:12pt">，且带参数列表</span><span style="font-family:'Times New Roman'; font-size:12pt">argv</span><span style="font-family:宋体; font-size:12pt">和环境变量列表</span><span style="font-family:'Times New Roman'; font-size:12pt">envp</span><span style="font-family:宋体; font-size:12pt">。只有发生错误时</span><span style="font-family:'Times New Roman'; font-size:12pt">execve</span><span style="font-family:宋体; font-size:12pt">才会返回到调用程序。所以，</span><span style="font-family:'Times New Roman'; font-size:12pt">execve</span><span style="font-family:宋体; font-size:12pt">调用一次且从不返回。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">加载并运行</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">需要以下几个步骤：</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1.</span><span style="font-family:宋体; font-size:12pt">删除已存在的用户区域。删除当前进程虚拟地址的用户部分中已存在的区域结构。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2.</span><span style="font-family:宋体; font-size:12pt">映射私有区域。为新程序的代码、数据、</span><span style="font-family:'Times New Roman'; font-size:12pt">bss</span><span style="font-family:宋体; font-size:12pt">和栈区域创建新的区域结构。所有这些新的区域都是私有的、写时复制的。代码和数据区被映射为</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">文件中的</span><span style="font-family:'Times New Roman'; font-size:12pt">.text</span><span style="font-family:宋体; font-size:12pt">和</span><span style="font-family:'Times New Roman'; font-size:12pt">.data</span><span style="font-family:宋体; font-size:12pt">区。</span><span style="font-family:'Times New Roman'; font-size:12pt">bss</span><span style="font-family:宋体; font-size:12pt">区域是请求二进制零的，映射到匿名文件，其大小包含在</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">中。栈和堆区域也是请求二进制零的，初始长度为零。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">3.</span><span style="font-family:宋体; font-size:12pt">映射共享区域。如果</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">程序与共享对象链接，那么这些对象都是动态链接到这个程序的，然后再映射到用户虚拟地址空间中的共享区域内。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">4.</span><span style="font-family:宋体; font-size:12pt">设置程序计数器。设置当前进程上下文中的程序计数器，使之指向代码区域的入口点。下一次调度这个进程时，它将从这个入口点开始执行。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238431"><span style="font-family:黑体; font-size:15pt">6.5 Hello的进程执行</span></a></h2><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">系统中的每个程序都运行在某个进程的上下文中。上下文是由程序正确运行所需的状态组成的。这个状态包括存放在内存中的程序的代码和数据，它的栈、通用目的寄存器的内容、程序计数器、环境变量以及打开文件描述符的集合。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">一个进程执行它的控制流的一部分的每一时间段叫做时间片。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">处理器通常用某个控制寄存器的一个模式位来提供用户模式和内核模式的功能。设置了模式位时，进程就运行在内核模式中，该进程可以执行指令集中的任何指令，可以访问系统中的任何内存位置。没有设置模式位时，进程就运行在用户模式中，用户模式中的进程不允许执行特权指令。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">在进程执行的某些时刻，内核可以决定抢占当前进程，并重新开始一个先前被抢占了的进程的决定叫做调度。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">程序在执行</span><span style="font-family:'Times New Roman'; font-size:12pt">sleep</span><span style="font-family:宋体; font-size:12pt">函数时，</span><span style="font-family:'Times New Roman'; font-size:12pt">sleep</span><span style="font-family:宋体; font-size:12pt">函数首先会调用</span><span style="font-family:'Times New Roman'; font-size:12pt">atoi</span><span style="font-family:宋体; font-size:12pt">函数将</span><span style="font-family:'Times New Roman'; font-size:12pt">argv[3]</span><span style="font-family:宋体; font-size:12pt">中的字符或字符串转换为整型数字，此时</span><span style="font-family:'Times New Roman'; font-size:12pt">sleep</span><span style="font-family:宋体; font-size:12pt">函数调用</span><span style="font-family:'Times New Roman'; font-size:12pt">wait</span><span style="font-family:宋体; font-size:12pt">或</span><span style="font-family:'Times New Roman'; font-size:12pt">waitpid</span><span style="font-family:宋体; font-size:12pt">函数挂起直到</span><span style="font-family:'Times New Roman'; font-size:12pt">atoi</span><span style="font-family:宋体; font-size:12pt">函数执行完成并返回一个数字，此时</span><span style="font-family:'Times New Roman'; font-size:12pt">sleep</span><span style="font-family:宋体; font-size:12pt">函数作为父进程回收执行</span><span style="font-family:'Times New Roman'; font-size:12pt">atoi</span><span style="font-family:宋体; font-size:12pt">函数的子进程。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">此时，在</span><span style="font-family:'Times New Roman'; font-size:12pt">sleep</span><span style="font-family:宋体; font-size:12pt">函数获取参数后，</span><span style="font-family:'Times New Roman'; font-size:12pt">sleep</span><span style="font-family:宋体; font-size:12pt">系统调用显式地请求让调用进程休眠，调度器抢占当前进程，并使用一种称为上下文切换的机制来将控制转移到新的进程。</span><span style="font-family:'Times New Roman'; font-size:12pt">sleep</span><span style="font-family:宋体; font-size:12pt">的倒计时结束后，控制会回到</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">进程中。程序调用</span><span style="font-family:'Times New Roman'; font-size:12pt">getchar()</span><span style="font-family:宋体; font-size:12pt">时，内核可以执行上下文切换，将控制转移到其他进程。</span><span style="font-family:'Times New Roman'; font-size:12pt">getchar()</span><span style="font-family:宋体; font-size:12pt">的数据传输结束之后，引发一个中断信号，控制回到</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">进程中</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238432"><span style="font-family:黑体; font-size:15pt">6.6 hello的异常与信号处理</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt"> </span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">执行过程中会出现哪几类异常，会产生哪些信号，又怎么处理的。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt"> 程序运行过程中可以按键盘，如不停乱按，包括回车，</span><span style="font-family:'Times New Roman'; font-size:12pt">Ctrl-Z</span><span style="font-family:宋体; font-size:12pt">，</span><span style="font-family:'Times New Roman'; font-size:12pt">Ctrl-C</span><span style="font-family:宋体; font-size:12pt">等，</span><span style="font-family:'Times New Roman'; font-size:12pt">Ctrl-z</span><span style="font-family:宋体; font-size:12pt">后可以运行</span><span style="font-family:'Times New Roman'; font-size:12pt">ps  jobs  pstree  fg  kill </span><span style="font-family:宋体; font-size:12pt">等命令，请分别给出各命令及运行结截屏，说明异常与信号的处理。</span></p><ol type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:12pt">正常退出：</span></li></ol><p style="margin:0pt 0pt 0pt 21pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.031.png" width="561" height="275" alt="进程1" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><ol start="2" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0; </span><span style="font-family:'Times New Roman'; font-size:12pt">Ctrl+z</span><span style="font-family:宋体; font-size:12pt">中断进程后运行</span><span style="font-family:'Times New Roman'; font-size:12pt">fg</span><span style="font-family:宋体; font-size:12pt">，使后台进程继续运行，信号：</span><span style="font-family:'Times New Roman'; font-size:12pt">SIGCONTIN</span><span style="font-family:宋体; font-size:12pt">（</span><span style="font-family:'Times New Roman'; font-size:12pt">fg</span><span style="font-family:宋体; font-size:12pt">）</span></li></ol><p style="margin:0pt 0pt 0pt 21pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.032.png" width="531" height="362" alt="进程2" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><ol start="3" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0; </span><span style="font-family:'Times New Roman'; font-size:12pt">Ctrl+z</span><span style="font-family:宋体; font-size:12pt">后运行</span><span style="font-family:'Times New Roman'; font-size:12pt">jobs</span></li></ol><p style="margin:0pt 0pt 0pt 21pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.033.png" width="543" height="165" alt="jobs" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="margin:0pt 0pt 0pt 21pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><ol start="4" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0; </span><span style="font-family:'Times New Roman'; font-size:12pt">Ctrl+z</span><span style="font-family:宋体; font-size:12pt">后运行</span><span style="font-family:'Times New Roman'; font-size:12pt">pstree</span><span style="font-family:宋体; font-size:12pt">（这里我找到的是</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">所在处，上一级进程是</span><span style="font-family:'Times New Roman'; font-size:12pt">systemd</span><span style="font-family:宋体; font-size:12pt">）</span></li></ol><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><p style="margin:0pt 0pt 0pt 21pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.034.png" width="562" height="89" alt="pstree" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><ol start="5" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0; </span><span style="font-family:'Times New Roman'; font-size:12pt">Ctrl+z</span><span style="font-family:宋体; font-size:12pt">后运行</span><span style="font-family:'Times New Roman'; font-size:12pt">kill</span><span style="font-family:宋体; font-size:12pt">命令</span></li></ol><p style="margin:0pt 0pt 0pt 21pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.035.png" width="555" height="219" alt="kill" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="margin:0pt 0pt 0pt 21pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">如图，平时显示进程已经成功被杀死</span></p><ol start="6" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0; </span><span style="font-family:宋体; font-size:12pt">不停乱按：</span></li></ol><p style="margin:0pt 0pt 0pt 24pt; orphans:0; text-align:justify; text-indent:20.95pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.036.png" width="487" height="454" alt="乱按" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><ol start="7" type="1" style="margin:0pt; padding-left:0pt"><li style="font-family:'Times New Roman'; font-size:12pt; list-style-position:inside; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font:7.0pt 'Times New Roman'">&#xa0;&#xa0; </span><span style="font-family:'Times New Roman'; font-size:12pt">Ctrl+c</span><span style="font-family:宋体; font-size:12pt">结束进程：终止</span></li></ol><p style="margin:0pt 0pt 0pt 24pt; orphans:0; text-align:justify; text-indent:20.95pt; widows:0"><span style="font-family:宋体; font-size:12pt">信号：</span><span style="font-family:'Times New Roman'; font-size:12pt">SIGINT</span></p><p style="margin:0pt 0pt 0pt 24pt; orphans:0; text-align:justify; text-indent:20.95pt; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.037.png" width="480" height="199" alt="终止进程" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238433"><span style="font-family:黑体; font-size:15pt">6.7本章小结</span></a></h2><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:宋体; font-size:12pt; font-weight:normal">本章中阐述了进程的概念以及他在计算机中具体是如何在使用的。其次，还介绍了如何利用shell这个平台来对进程进行监理调用或发送信号等一系列操作。</span></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">（第</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">6</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">章</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">1</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">分）</span></p><h1 style="line-height:40pt; margin:20pt 0pt 10pt; orphans:0; text-align:center; widows:0"><br style="page-break-before:always; clear:both" /><a name="_Toc532238434"><span style="font-family:黑体; font-size:18pt; font-weight:bold">第</span><span style="font-family:黑体; font-size:18pt; font-weight:bold">7</span><span style="font-family:黑体; font-size:18pt; font-weight:bold">章 </span><span style="font-family:黑体; font-size:18pt; font-weight:bold">hello的存储管理</span></a></h1><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238435"><span style="font-family:黑体; font-size:15pt">7.1 hello的存储器地址空间</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238436"><span style="font-family:宋体; font-size:12pt">逻辑地址：在有地址变换功能的计算机中，访内指令给出的地址 </span><span style="font-family:'Times New Roman'; font-size:12pt">(</span><span style="font-family:宋体; font-size:12pt">操作数</span><span style="font-family:'Times New Roman'; font-size:12pt">) </span><span style="font-family:宋体; font-size:12pt">叫逻辑地址，也叫相对地址。要经过寻址方式的计算或变换才得到内存储器中的实际有效地址，即物理地址。是</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.o</span><span style="font-family:宋体; font-size:12pt">中的相对偏移地址。</span></a></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">线性地址：线性地址（</span><span style="font-family:'Times New Roman'; font-size:12pt">Linear Address</span><span style="font-family:宋体; font-size:12pt">）是逻辑地址到物理地址变换之间的中间层。在分段部件中逻辑地址是段中的偏移地址，然后加上基地址就是线性地址。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">虚拟地址：程序访问存储器所使用的逻辑地址称为虚拟地址。是</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">里的虚拟内存地址。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">物理地址：在存储器里以字节为单位存储信息，为正确地存放或取得信息，每一个字节单元给以一个唯一的存储器地址，称为物理地址。是</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">里虚拟内存地址对应的物理地址。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">7.2 Intel逻辑地址到线性地址的变换-段式管理</span><span style="-aw-bookmark-end:_Toc532238436"></span></h2><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1.</span><span style="font-family:宋体; font-size:12pt">基本原理：</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">在段式存储管理中，将程序的地址空间划分为若干个段</span><span style="font-family:'Times New Roman'; font-size:12pt">(segment)</span><span style="font-family:宋体; font-size:12pt">，这样每个进程有一个二维的地址空间。在段式存储管理系统中，为每个段分配一个连续的分区，而进程中的各个段可以不连续地存放在内存的不同分区中。程序加载时，操作系统为所有段分配其所需内存，这些段不必连续，物理内存的管理采用动态分区的管理方法。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">在为某个段分配物理内存时，可以采用首先适配法、下次适配法、最佳适配法等方法。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">在回收某个段所占用的空间时，要注意将收回的空间与其相邻的空间合并。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">段式存储管理也需要硬件支持，实现逻辑地址到物理地址的映射。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">程序通过分段划分为多个模块，如代码段、数据段、共享段：</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">–可以分别编写和编译</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">–可以针对不同类型的段采取不同的保护</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">–可以按段为单位来进行共享，包括通过动态链接进行代码共享</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">这样做的优点是：可以分别编写和编译源程序的一个文件，并且可以针对不同类型的段采取不同的保护，也可以按段为单位来进行共享。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">总的来说，段式存储管理的优点是：没有内碎片，外碎片可以通过内存紧缩来消除；便于实现内存共享。缺点与页式存储管理的缺点相同，进程必须全部装入内存。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2.</span><span style="font-family:宋体; font-size:12pt">段式管理的数据结构：</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">为了实现段式管理，操作系统需要如下的数据结构来实现进程的地址空间到物理内存空间的映射，并跟踪物理内存的使用情况，以便在装入新的段的时候，合理地分配内存空间。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt">·进程段表：描述组成进程地址空间的各段，可以是指向系统段表中表项的索引。每段有段基址</span><span style="font-family:'Times New Roman'; font-size:12pt">(baseaddress)</span><span style="font-family:宋体; font-size:12pt">，即段内地址。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238437"><span style="font-family:黑体; font-size:15pt">7.3 Hello的线性地址到物理地址的变换-页式管理</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238438"><span style="font-family:宋体; font-size:12pt">线性地址到物理地址的转换是通过页的这个概念完成的。线性地址被分为以固定长度为单位的组，称为页。</span></a></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">首先 </span><span style="font-family:'Times New Roman'; font-size:12pt">Linux </span><span style="font-family:宋体; font-size:12pt">系统有自己的虚拟内存系统，其虚拟内存组织形式如图 </span><span style="font-family:'Times New Roman'; font-size:12pt">7-4</span><span style="font-family:宋体; font-size:12pt">所示，</span><span style="font-family:'Times New Roman'; font-size:12pt">Linux </span><span style="font-family:宋体; font-size:12pt">将虚拟内存组织成一些段的集合，段之外的虚拟内存不存在因此不需要记录。内核为</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">进程维护一个段的任务结构即图中的</span><span style="font-family:'Times New Roman'; font-size:12pt">task_struct</span><span style="font-family:宋体; font-size:12pt">，其中条目</span><span style="font-family:'Times New Roman'; font-size:12pt">mm</span><span style="font-family:宋体; font-size:12pt">指向一个</span><span style="font-family:'Times New Roman'; font-size:12pt">mm_struct</span><span style="font-family:宋体; font-size:12pt">，它描述了虚拟内存的当前状态，</span><span style="font-family:'Times New Roman'; font-size:12pt">pgd </span><span style="font-family:宋体; font-size:12pt">指向第一级页表的基地址（结合一个进程一串页表），</span><span style="font-family:'Times New Roman'; font-size:12pt">mmap</span><span style="font-family:宋体; font-size:12pt">指向一个</span><span style="font-family:'Times New Roman'; font-size:12pt">vm_area_struct </span><span style="font-family:宋体; font-size:12pt">的链表，一个链表条目对应一个段，所以链表相连指出了 </span><span style="font-family:'Times New Roman'; font-size:12pt">hello </span><span style="font-family:宋体; font-size:12pt">进程虚拟内存中的所有段。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.038.png" width="567" height="387" alt="图1" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">CPU</span><span style="font-family:宋体; font-size:12pt">芯片上有一个专门的硬件叫做内存管理单元（</span><span style="font-family:'Times New Roman'; font-size:12pt">MMU</span><span style="font-family:宋体; font-size:12pt">），这个硬件的功能就是动态的将虚拟地址翻译成物理地址的。这个表示如何工作的呢，如图</span><span style="font-family:'Times New Roman'; font-size:12pt">7-5</span><span style="font-family:宋体; font-size:12pt">所示。</span><span style="font-family:'Times New Roman'; font-size:12pt">N</span><span style="font-family:宋体; font-size:12pt">为的虚拟地址包含两个部分，一个</span><span style="font-family:'Times New Roman'; font-size:12pt">p</span><span style="font-family:宋体; font-size:12pt">位的虚拟页面偏移（</span><span style="font-family:'Times New Roman'; font-size:12pt">VPO</span><span style="font-family:宋体; font-size:12pt">）和一个（</span><span style="font-family:'Times New Roman'; font-size:12pt">n-p</span><span style="font-family:宋体; font-size:12pt">）位的虚拟页号（</span><span style="font-family:'Times New Roman'; font-size:12pt">VPN</span><span style="font-family:宋体; font-size:12pt">）。</span><span style="font-family:'Times New Roman'; font-size:12pt">MMU</span><span style="font-family:宋体; font-size:12pt">利用</span><span style="font-family:'Times New Roman'; font-size:12pt">VPN</span><span style="font-family:宋体; font-size:12pt">来选择适当的</span><span style="font-family:'Times New Roman'; font-size:12pt">PTE</span><span style="font-family:宋体; font-size:12pt">（页表条目）。接下来在对应的</span><span style="font-family:'Times New Roman'; font-size:12pt">PTE</span><span style="font-family:宋体; font-size:12pt">中获得</span><span style="font-family:'Times New Roman'; font-size:12pt">PPN</span><span style="font-family:宋体; font-size:12pt">（物理页号），将</span><span style="font-family:'Times New Roman'; font-size:12pt">PPN</span><span style="font-family:宋体; font-size:12pt">与</span><span style="font-family:'Times New Roman'; font-size:12pt">VPO</span><span style="font-family:宋体; font-size:12pt">串联起来，就得到了相应的物理地址</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.039.png" width="567" height="291" alt="图2" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">7.4 TLB与四级页表支持下的VA到PA的变换</span><span style="-aw-bookmark-end:_Toc532238438"></span></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238439"><span style="font-family:'Times New Roman'; font-size:12pt">36</span><span style="font-family:宋体; font-size:12pt">位的虚拟地址被分割成</span><span style="font-family:'Times New Roman'; font-size:12pt">4</span><span style="font-family:宋体; font-size:12pt">个</span><span style="font-family:'Times New Roman'; font-size:12pt">9</span><span style="font-family:宋体; font-size:12pt">位的片。</span><span style="font-family:'Times New Roman'; font-size:12pt">CR3</span><span style="font-family:宋体; font-size:12pt">寄存器包含</span><span style="font-family:'Times New Roman'; font-size:12pt">L1</span><span style="font-family:宋体; font-size:12pt">页表的物理地址。</span><span style="font-family:'Times New Roman'; font-size:12pt">VPN1</span><span style="font-family:宋体; font-size:12pt">有一个到</span><span style="font-family:'Times New Roman'; font-size:12pt">L1 PTE</span><span style="font-family:宋体; font-size:12pt">的偏移量，找到这个</span><span style="font-family:'Times New Roman'; font-size:12pt">PTE</span><span style="font-family:宋体; font-size:12pt">以后又会包含到</span><span style="font-family:'Times New Roman'; font-size:12pt">L2</span><span style="font-family:宋体; font-size:12pt">页表的基础地址；</span><span style="font-family:'Times New Roman'; font-size:12pt">VPN2</span><span style="font-family:宋体; font-size:12pt">包含一个到</span><span style="font-family:'Times New Roman'; font-size:12pt">L2PTE</span><span style="font-family:宋体; font-size:12pt">的偏移量，找到这个</span><span style="font-family:'Times New Roman'; font-size:12pt">PTE</span><span style="font-family:宋体; font-size:12pt">以后又会包含到</span><span style="font-family:'Times New Roman'; font-size:12pt">L3</span><span style="font-family:宋体; font-size:12pt">页表的基础地址；</span><span style="font-family:'Times New Roman'; font-size:12pt">VPN3</span><span style="font-family:宋体; font-size:12pt">包含一个到</span><span style="font-family:'Times New Roman'; font-size:12pt">L3PTE</span><span style="font-family:宋体; font-size:12pt">的偏移量，找到这个</span><span style="font-family:'Times New Roman'; font-size:12pt">PTE</span><span style="font-family:宋体; font-size:12pt">以后又会包含到</span><span style="font-family:'Times New Roman'; font-size:12pt">L4</span><span style="font-family:宋体; font-size:12pt">页表的基础地址；</span><span style="font-family:'Times New Roman'; font-size:12pt">VPN4</span><span style="font-family:宋体; font-size:12pt">包含一个到</span><span style="font-family:'Times New Roman'; font-size:12pt">L4PTE</span><span style="font-family:宋体; font-size:12pt">的偏移量，找到这个</span><span style="font-family:'Times New Roman'; font-size:12pt">PTE</span><span style="font-family:宋体; font-size:12pt">以后就是相应的</span><span style="font-family:'Times New Roman'; font-size:12pt">PPN</span><span style="font-family:宋体; font-size:12pt">（物理页号）。</span></a></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><img src="56ddce64-b647-4733-ad58-b72a90290a85.040.png" width="567" height="397" alt="图3" style="-aw-left-pos:0pt; -aw-rel-hpos:page; -aw-rel-vpos:page; -aw-top-pos:0pt; -aw-wrap-type:inline" /></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">7.5 三级Cache支持下的物理内存访问</span><span style="-aw-bookmark-end:_Toc532238439"></span></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238440"><span style="font-family:宋体; font-size:12pt">在上面，</span><span style="font-family:宋体; font-size:12pt">我们已经获得了物理地址</span><span style="font-family:'Times New Roman'; font-size:12pt">VA</span><span style="font-family:宋体; font-size:12pt">，我们接着图</span><span style="font-family:'Times New Roman'; font-size:12pt">7-6</span><span style="font-family:宋体; font-size:12pt">的右侧部分进行说明。使用</span><span style="font-family:'Times New Roman'; font-size:12pt">CI</span><span style="font-family:宋体; font-size:12pt">（后六位再后六位）进行组索引，每组</span><span style="font-family:'Times New Roman'; font-size:12pt">8</span><span style="font-family:宋体; font-size:12pt">路，对</span><span style="font-family:'Times New Roman'; font-size:12pt">8</span><span style="font-family:宋体; font-size:12pt">路的块分别匹配 </span><span style="font-family:'Times New Roman'; font-size:12pt">CT</span><span style="font-family:宋体; font-size:12pt">（前</span><span style="font-family:'Times New Roman'; font-size:12pt">40</span><span style="font-family:宋体; font-size:12pt">位）如果匹配成功且块的</span><span style="font-family:'Times New Roman'; font-size:12pt">valid</span><span style="font-family:宋体; font-size:12pt">标志位为</span><span style="font-family:'Times New Roman'; font-size:12pt">1</span><span style="font-family:宋体; font-size:12pt">，则命中（</span><span style="font-family:'Times New Roman'; font-size:12pt">hit</span><span style="font-family:宋体; font-size:12pt">），根据数据偏移量</span><span style="font-family:'Times New Roman'; font-size:12pt">CO</span><span style="font-family:宋体; font-size:12pt">（后六位）取出数据返回。 如果没有匹配成功或者匹配成功但是标志位是 </span><span style="font-family:'Times New Roman'; font-size:12pt">1</span><span style="font-family:宋体; font-size:12pt">，则不命中（</span><span style="font-family:'Times New Roman'; font-size:12pt">miss</span><span style="font-family:宋体; font-size:12pt">），向下一级缓存中查询数据（</span><span style="font-family:'Times New Roman'; font-size:12pt">L2 Cache-&gt;L3 Cache-&gt;</span><span style="font-family:宋体; font-size:12pt">主存）。查询到数据之后，一种简单的放置策略如下：如果映射到的组内有空闲块，则直接放置，否则组内都是有效块，产生冲突（</span><span style="font-family:'Times New Roman'; font-size:12pt">evict</span><span style="font-family:宋体; font-size:12pt">），则采用最近最少使用策略 </span><span style="font-family:'Times New Roman'; font-size:12pt">LFU </span><span style="font-family:宋体; font-size:12pt">进行替换。</span></a></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">7.6 hello进程fork时的内存映射</span><span style="-aw-bookmark-end:_Toc532238440"></span></h2><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><a name="_Toc532238441"><span style="font-family:宋体; font-size:12pt">在</span><span style="font-family:'Times New Roman'; font-size:12pt">7.3</span><span style="font-family:宋体; font-size:12pt">节中我们已经提到过了</span><span style="font-family:'Times New Roman'; font-size:12pt">mm_struct</span><span style="font-family:宋体; font-size:12pt">和</span><span style="font-family:'Times New Roman'; font-size:12pt">vm_area_struct</span><span style="font-family:宋体; font-size:12pt">这两个标记符，这里我们就需要用到他们。先来介绍一下：</span></a></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">mm_struct</span><span style="font-family:宋体; font-size:12pt">（内存描述符）：描述了一个进程的整个虚拟内存空间。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">vm_area_struct</span><span style="font-family:宋体; font-size:12pt">（区域结构描述符）：描述了进程的虚拟内存空间的一个区间。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">在用</span><span style="font-family:'Times New Roman'; font-size:12pt">fork</span><span style="font-family:宋体; font-size:12pt">创建内存的时候，我们需要以下三个步骤：</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1</span><span style="font-family:宋体; font-size:12pt">：</span><span style="font-family:宋体; font-size:12pt">创建当前进程的</span><span style="font-family:'Times New Roman'; font-size:12pt">mm_struct</span><span style="font-family:宋体; font-size:12pt">，</span><span style="font-family:'Times New Roman'; font-size:12pt">vm_area_struct</span><span style="font-family:宋体; font-size:12pt">和页表的原样副本。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2</span><span style="font-family:宋体; font-size:12pt">：</span><span style="font-family:宋体; font-size:12pt">两个进程的每个页面都标记为只读页面。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">3</span><span style="font-family:宋体; font-size:12pt">：</span><span style="font-family:宋体; font-size:12pt">两个进程的每个</span><span style="font-family:'Times New Roman'; font-size:12pt">vm_area_struct</span><span style="font-family:宋体; font-size:12pt">都标记为私有，这样就只能在写入时复制。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">7.7 hello进程execve时的内存映射</span><span style="-aw-bookmark-end:_Toc532238441"></span></h2><p style="margin:0pt; orphans:0; text-align:justify; text-indent:21pt; widows:0"><span style="font-family:宋体; font-size:12pt; font-weight:normal"> </span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">execve</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">函数在</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">shell</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">中加载并运行包含在可执行目标文件</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">hello</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">中的程序，用</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">hello</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">程序有效的替代了当前程序。加载并运行</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">hello</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">需要以下几个步骤：</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">1</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">：</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">删除已存在的用户区域。删除</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">shell</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">虚拟地址的用户部分中的已存在的区域结构。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">2</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">：</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">映射私有区域。为</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">hello</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">的代码、数据、</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">bss </span><span style="font-family:宋体; font-size:12pt; font-weight:normal">和栈区域创建新的区域结构。所有这些新的区域都是私有的、写时复制的。代码和数据区域被映射为</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">hello </span><span style="font-family:宋体; font-size:12pt; font-weight:normal">文件中的</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">.text</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">和</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">.data </span><span style="font-family:宋体; font-size:12pt; font-weight:normal">区。</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">bss </span><span style="font-family:宋体; font-size:12pt; font-weight:normal">区域是请求二进制零的，映射到匿名文件，其大小包含在</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">hello </span><span style="font-family:宋体; font-size:12pt; font-weight:normal">中。栈和堆区域也是请求二进制零的，初始长度为零。图</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">7.7 </span><span style="font-family:宋体; font-size:12pt; font-weight:normal">概括了私有区域的不同映射。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">3</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">：</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">映射共享区域。如果</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">hello</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">程序与共享对象（或目标）链接，比如标准</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">C </span><span style="font-family:宋体; font-size:12pt; font-weight:normal">库</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">libc. so, </span><span style="font-family:宋体; font-size:12pt; font-weight:normal">那么这些对象都是动态链接到这个程序的，然后再映射到用户虚拟地址空间中的共享区域内。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">4</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">：</span><span style="font-family:宋体; font-size:12pt; font-weight:normal">设置程序计数器</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">(PC) </span><span style="font-family:宋体; font-size:12pt; font-weight:normal">。</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:normal">execve </span><span style="font-family:宋体; font-size:12pt; font-weight:normal">做的最后一件事情就是设置当前进程上下文中的程序计数器，使之指向代码区域的入口点。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238442"><span style="font-family:黑体; font-size:15pt">7.8 缺页故障与缺页中断处理</span></a></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238443"><span style="font-family:宋体; font-size:12pt">在虚拟内存的习惯说法中，</span><span style="font-family:'Times New Roman'; font-size:12pt">DRAM</span><span style="font-family:宋体; font-size:12pt">缓存不命中称为缺页。例如：</span><span style="font-family:'Times New Roman'; font-size:12pt">CPU</span><span style="font-family:宋体; font-size:12pt">引用了</span><span style="font-family:'Times New Roman'; font-size:12pt">VP3</span><span style="font-family:宋体; font-size:12pt">中的一个字，</span><span style="font-family:'Times New Roman'; font-size:12pt">VP3</span><span style="font-family:宋体; font-size:12pt">并未缓存在</span><span style="font-family:'Times New Roman'; font-size:12pt">DRAM</span><span style="font-family:宋体; font-size:12pt">中。地址翻译硬件从内存中读取</span><span style="font-family:'Times New Roman'; font-size:12pt">PTE3</span><span style="font-family:宋体; font-size:12pt">，从有效位推断出</span><span style="font-family:'Times New Roman'; font-size:12pt">VP3</span><span style="font-family:宋体; font-size:12pt">未被缓存，并且触发一个缺页异常。缺页异常调用内核中的缺页异常处理程序，该程序会选择一个牺牲页，在此例中就是存放在</span><span style="font-family:'Times New Roman'; font-size:12pt">PP3</span><span style="font-family:宋体; font-size:12pt">中的</span><span style="font-family:'Times New Roman'; font-size:12pt">VP4</span><span style="font-family:宋体; font-size:12pt">。如果</span><span style="font-family:'Times New Roman'; font-size:12pt">VP4</span><span style="font-family:宋体; font-size:12pt">已经被修改了，那么内核就会将它复制回磁盘。无论哪种情况，内核都会修改</span><span style="font-family:'Times New Roman'; font-size:12pt">VP4</span><span style="font-family:宋体; font-size:12pt">的页表条目，反映出</span><span style="font-family:'Times New Roman'; font-size:12pt">VP4</span><span style="font-family:宋体; font-size:12pt">不再缓存在主存中这一事实</span></a></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">7.9动态存储分配管理</span><span style="-aw-bookmark-end:_Toc532238443"></span></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238444"><span style="font-family:宋体; font-size:12pt">动态内存分配器维护着一个进程的虚拟内存区域，称为堆。分配器将堆视为一组不同大小的块的集合来维护。每个块就是一个连续的虚拟内存片，要么是已分配的，要么是空闲的。已分配的块显式地保留为供应用程序使用。空闲块可用来分配。空闲块保持空闲，直到它显式地被应用所分配。一个已分配的块保持已分配状态，直到它被释放，这种释放要么是应用程序显式执行的，要么是内存分配器自身隐式执行的。</span></a></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1.</span><span style="font-family:宋体; font-size:12pt">隐式空闲链表：</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">空闲块通过头部中的大小字段隐含地连接着。分配器可以通过遍历堆中所有的块，从而间接地遍历整个空闲块的集合。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">（</span><span style="font-family:'Times New Roman'; font-size:12pt">1</span><span style="font-family:宋体; font-size:12pt">）放置策略：首次适配、下一次适配、最佳适配。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">首次适配从头开始搜索空闲链表，选择第一个合适的空闲块。下一次适配从上一次查询结束的地方开始。最佳适配检查每个空闲块，选择适合所需请求大小的最小空闲块。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">（</span><span style="font-family:'Times New Roman'; font-size:12pt">2</span><span style="font-family:宋体; font-size:12pt">）合并策略：立即合并、推迟合并。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">立即合并就是在每次一个块被释放时，就合并所有的相邻块；推迟合并就是等到某个稍晚的时候再合并空闲块。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">带边界标记的合并</span><span style="font-family:'Times New Roman'; font-size:12pt">:</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">在每个块的结尾添加一个脚部，分配器就可以通过检查它的脚部，判断前面一个块的起始位置和状态，从而使得对前面块的合并能够在常数时间之内进行。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2.</span><span style="font-family:宋体; font-size:12pt">显式空闲链表</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">每个空闲块中，都包含一个</span><span style="font-family:'Times New Roman'; font-size:12pt">pred</span><span style="font-family:宋体; font-size:12pt">（前驱）和</span><span style="font-family:'Times New Roman'; font-size:12pt">succ</span><span style="font-family:宋体; font-size:12pt">（后继）指针。使用双向链表使首次适配的时间减少到空闲块数量的线性时间。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">空闲链表中块的排序策略：一种是用后进先出的顺序维护链表，将新释放的块放置在链表的开始处，另一种方法是按照地址顺序来维护链表，链表中每个块的地址都小于它后继的地址。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">分离存储：维护多个空闲链表，每个链表中的块有大致相等的大小。将所有可能的块大小分成一些等价类，也叫做大小类。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">分离存储的方法：简单分离存储和分离适配。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">7.10本章小结</span><span style="-aw-bookmark-end:_Toc532238444"></span></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">本章讨论了存储器地址空间，段式管理、页式管理，TLB与四级页表支持下的VA到PA的变换，三级Cache支持下的物理内存访问，hello进程fork时和execve时的内存映射，缺页故障与缺页中断处理和动态存储分配管理。</span></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">（第</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">7</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">章 </span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">2</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">分）</span></p><h1 style="line-height:40pt; margin:20pt 0pt 10pt; orphans:0; text-align:center; widows:0"><br style="page-break-before:always; clear:both" /><a name="_Toc532238445"><span style="font-family:黑体; font-size:18pt; font-weight:bold">第</span><span style="font-family:黑体; font-size:18pt; font-weight:bold">8</span><span style="font-family:黑体; font-size:18pt; font-weight:bold">章 </span><span style="font-family:黑体; font-size:18pt; font-weight:bold">hello的IO管理</span></a></h1><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238446"><span style="font-family:黑体; font-size:15pt">8.1 Linux的IO设备管理方法</span></a></h2><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238447"><span style="font-family:宋体; font-size:12pt">所有的I/O设备（例如网络、磁盘和终端）都被模型化为文件，而所有的输入和输出都被当做对相应文件的读和写来执行。这种将设备优雅地映射为文件的方式，允许Linux内核引出一个简单、低级的应用接口，称为Unix I/O，这使得所有的输入和输出都能以一种统一且一致的方式来执行。</span></a></h2><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">8.2 简述Unix IO接口及其函数</span><span style="-aw-bookmark-end:_Toc532238447"></span></h2><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238448"><span style="font-family:'Times New Roman'; font-size:12pt">I/O</span><span style="font-family:宋体; font-size:12pt">接口操作</span></a></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1.</span><span style="font-family:宋体; font-size:12pt">打开文件：一个应用程序通过要求内核打开相应的文件，来宣告它想要访问一个</span><span style="font-family:'Times New Roman'; font-size:12pt">I/O</span><span style="font-family:宋体; font-size:12pt">设备。内核返回一个小的非负整数，叫做描述符，它在后续对此文件的所有操作中标识这个文件。内核记录有关这个打开文件的所有信息。应用程序只需记住这个描述符。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2.Linux shell</span><span style="font-family:宋体; font-size:12pt">创建的每个进程开始时都有三个打开的文件：标准输入、标准输出和标准错误。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">3.</span><span style="font-family:宋体; font-size:12pt">改变当前的文件位置：对于每个打开的文件，内核保持着一个文件位置</span><span style="font-family:'Times New Roman'; font-size:12pt">k</span><span style="font-family:宋体; font-size:12pt">，初始为</span><span style="font-family:'Times New Roman'; font-size:12pt">0.</span><span style="font-family:宋体; font-size:12pt">这个文件位置是从文件开头起始的字节偏移量。应用程序能够通过执行</span><span style="font-family:'Times New Roman'; font-size:12pt">seek</span><span style="font-family:宋体; font-size:12pt">操作，显式地设置文件的当前位置为</span><span style="font-family:'Times New Roman'; font-size:12pt">k</span><span style="font-family:宋体; font-size:12pt">。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">4.</span><span style="font-family:宋体; font-size:12pt">读写文件：一个读操作就是从文件复制</span><span style="font-family:'Times New Roman'; font-size:12pt">n&gt;0</span><span style="font-family:宋体; font-size:12pt">个字节到内存，从当前文件位置</span><span style="font-family:'Times New Roman'; font-size:12pt">k</span><span style="font-family:宋体; font-size:12pt">开始，然后将</span><span style="font-family:'Times New Roman'; font-size:12pt">k</span><span style="font-family:宋体; font-size:12pt">增加到</span><span style="font-family:'Times New Roman'; font-size:12pt">k+n</span><span style="font-family:宋体; font-size:12pt">。给定一个大小为</span><span style="font-family:'Times New Roman'; font-size:12pt">m</span><span style="font-family:宋体; font-size:12pt">字节的文件，当</span><span style="font-family:'Times New Roman'; font-size:12pt">k&gt;=m</span><span style="font-family:宋体; font-size:12pt">时执行读操作会触发一个称为</span><span style="font-family:'Times New Roman'; font-size:12pt">end-of-file</span><span style="font-family:宋体; font-size:12pt">（</span><span style="font-family:'Times New Roman'; font-size:12pt">EOF</span><span style="font-family:宋体; font-size:12pt">）的条件，应用程序能检测到这个条件。在文件结尾处并没有明确的“</span><span style="font-family:'Times New Roman'; font-size:12pt">EOF</span><span style="font-family:宋体; font-size:12pt">符号”。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">类似地，写操作就是从内存复制</span><span style="font-family:'Times New Roman'; font-size:12pt">n&gt;0</span><span style="font-family:宋体; font-size:12pt">个字节到一个文件，从当前文件位置</span><span style="font-family:'Times New Roman'; font-size:12pt">k</span><span style="font-family:宋体; font-size:12pt">开始，然后更新</span><span style="font-family:'Times New Roman'; font-size:12pt">k</span><span style="font-family:宋体; font-size:12pt">。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">5.</span><span style="font-family:宋体; font-size:12pt">关闭文件：当应用完成了对文件的访问之后，它就通知内核关闭这个文件。作为响应，内核释放文件打开时创建的数据结构，并将这个描述符恢复到可用的描述符池中。无论一个进程因为何种原因终止时，内核都会关闭所有打开的文件并释放它们的内存资源。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">函数：</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1.int open(char *filename, int flags, mode_t mode)</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">进程通过调用</span><span style="font-family:'Times New Roman'; font-size:12pt">open</span><span style="font-family:宋体; font-size:12pt">函数来打开一个已存在的文件或者创建一个新文件。</span><span style="font-family:'Times New Roman'; font-size:12pt">open</span><span style="font-family:宋体; font-size:12pt">函数将</span><span style="font-family:'Times New Roman'; font-size:12pt">filename</span><span style="font-family:宋体; font-size:12pt">转换为一个文件描述符，而且返回描述符数字。</span><span style="font-family:'Times New Roman'; font-size:12pt">flags</span><span style="font-family:宋体; font-size:12pt">参数指明了进程打算如何访问这个文件。</span><span style="font-family:'Times New Roman'; font-size:12pt">mode</span><span style="font-family:宋体; font-size:12pt">参数指定了新文件的访问权限位。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2.int close(int fd)</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">进程通过调用</span><span style="font-family:'Times New Roman'; font-size:12pt">close</span><span style="font-family:宋体; font-size:12pt">函数关闭一个打开的文件。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">3.ssize_t read(int fd, void *buf, size_t n)</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">应用程序通过调用</span><span style="font-family:'Times New Roman'; font-size:12pt">read</span><span style="font-family:宋体; font-size:12pt">函数来执行输入。</span><span style="font-family:'Times New Roman'; font-size:12pt">read</span><span style="font-family:宋体; font-size:12pt">函数从描述符为</span><span style="font-family:'Times New Roman'; font-size:12pt">fd</span><span style="font-family:宋体; font-size:12pt">的当前文件位置复制最多</span><span style="font-family:'Times New Roman'; font-size:12pt">n</span><span style="font-family:宋体; font-size:12pt">个字节到内存位置</span><span style="font-family:'Times New Roman'; font-size:12pt">buf</span><span style="font-family:宋体; font-size:12pt">。返回值</span><span style="font-family:'Times New Roman'; font-size:12pt">-1</span><span style="font-family:宋体; font-size:12pt">表示一个错误，返回值</span><span style="font-family:'Times New Roman'; font-size:12pt">0</span><span style="font-family:宋体; font-size:12pt">表示</span><span style="font-family:'Times New Roman'; font-size:12pt">EOF</span><span style="font-family:宋体; font-size:12pt">。否则返回值表示的是实际传送的字节数量。</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">4.ssize_t write(int fd, const void *buf, size_t n)</span></p><p style="margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">应用程序通过调用</span><span style="font-family:'Times New Roman'; font-size:12pt">write</span><span style="font-family:宋体; font-size:12pt">函数来执行输出。</span><span style="font-family:'Times New Roman'; font-size:12pt">write</span><span style="font-family:宋体; font-size:12pt">函数从内存位置</span><span style="font-family:'Times New Roman'; font-size:12pt">buf</span><span style="font-family:宋体; font-size:12pt">复制至多</span><span style="font-family:'Times New Roman'; font-size:12pt">n</span><span style="font-family:宋体; font-size:12pt">个字节到描述符</span><span style="font-family:'Times New Roman'; font-size:12pt">fd</span><span style="font-family:宋体; font-size:12pt">的当前文件位置。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:黑体; font-size:15pt">8.3 printf的实现分析</span><span style="-aw-bookmark-end:_Toc532238448"></span></h2><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><a href="https://www.cnblogs.com/pianist/p/3315801.html"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; text-decoration:underline">https://www.cnblogs.com/pianist/p/3315801.html</span></a></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">从</span><span style="font-family:'Times New Roman'; font-size:12pt">vsprintf</span><span style="font-family:宋体; font-size:12pt">生成显示信息，到</span><span style="font-family:'Times New Roman'; font-size:12pt">write</span><span style="font-family:宋体; font-size:12pt">系统函数，到陷阱</span><span style="font-family:'Times New Roman'; font-size:12pt">-</span><span style="font-family:宋体; font-size:12pt">系统调用 </span><span style="font-family:'Times New Roman'; font-size:12pt">int 0x80</span><span style="font-family:宋体; font-size:12pt">或</span><span style="font-family:'Times New Roman'; font-size:12pt">syscall.</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">字符显示驱动子程序：从</span><span style="font-family:'Times New Roman'; font-size:12pt">ASCII</span><span style="font-family:宋体; font-size:12pt">到字模库到显示</span><span style="font-family:'Times New Roman'; font-size:12pt">vram</span><span style="font-family:宋体; font-size:12pt">（存储每一个点的</span><span style="font-family:'Times New Roman'; font-size:12pt">RGB</span><span style="font-family:宋体; font-size:12pt">颜色信息）。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">显示芯片按照刷新频率逐行读取</span><span style="font-family:'Times New Roman'; font-size:12pt">vram</span><span style="font-family:宋体; font-size:12pt">，并通过信号线向液晶显示器传输每一个点（</span><span style="font-family:'Times New Roman'; font-size:12pt">RGB</span><span style="font-family:宋体; font-size:12pt">分量）。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">Printf</span><span style="font-family:宋体; font-size:12pt">代码：</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">int printf(const char *fmt, ...)   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">{   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">3.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">     int i;   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">4.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">     char buf[256];   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">5.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">      </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">6.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">     va_list arg = (va_list)((char*)(&amp;fmt) + 4);   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">7.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">     i = vsprintf(buf, fmt, arg);   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">8.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">     write(buf, i);   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">9.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">      </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">10.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">     return i;   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">11.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">} </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">其中，va_list是一个字符指针，arg表示函数的第二个参数。</span><br /><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:宋体; font-size:12pt"> </span><span style="font-family:宋体; font-size:12pt">vsprintf的代码：</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">int vsprintf(char *buf, const char *fmt, va_list args)   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">{   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">3.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    char* p;   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">4.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    char tmp[256];   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">5.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    va_list p_next_arg = args;   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">6.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">     </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">7.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    for (p=buf;*fmt;fmt++) {   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">8.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    if (*fmt != '%') {   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">9.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    *p++ = *fmt;   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">10.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    continue;   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">11.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    }   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">12.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">     </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">13.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    fmt++;   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">14.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">     </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">15.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    switch (*fmt) {   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">16.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    case 'x':   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">17.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    itoa(tmp, *((int*)p_next_arg));   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">18.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    strcpy(p, tmp);   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">19.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    p_next_arg += 4;   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">20.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    p += strlen(tmp);   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">21.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    break;   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">22.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    case 's':   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">23.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    break;   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">24.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    default:   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">25.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    break;   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">26.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    }   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">27.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    }   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">28.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">     </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">29.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    return (p - buf);</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">30.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">}   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">vsprintf的作用是格式化。它接受确定输出格式的格式字符串fnt。用格式字符串对个数变化的参数进行格式化，产生格式化输出，并返回要打印的字符串的长度。</span><br /><span style="font-family:宋体; font-size:12pt">write的代码</span></p><p style="margin:0pt"><span style="font-family:'Times New Roman'; font-size:12pt">mov eax, _NR_write </span></p><p style="margin:0pt"><span style="font-family:'Times New Roman'; font-size:12pt">mov ebx, [esp + 4] </span></p><p style="margin:0pt"><span style="font-family:'Times New Roman'; font-size:12pt">mov ecx, [esp + 8] </span></p><p style="margin:0pt"><span style="font-family:'Times New Roman'; font-size:12pt">int INT_VECTOR_SYS_CALL </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">先给寄存器传了几个参数，然后通过系统调用sys_call</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">sys_call</span><span style="font-family:宋体; font-size:12pt">：</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">call save </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">     push dword [p_proc_ready] </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">     sti </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">     push ecx </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">     push ebx </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">     call [sys_call_table + eax * 4] </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">     add esp, 4 * 3 </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">     mov [esi + EAXREG - P_STACKBASE], eax </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">     cli </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">     ret </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">syscall</span><span style="font-family:宋体; font-size:12pt">将字符串中的字节从寄存器中通过总线复制到显卡的显存中，显存中存储的是字符的</span><span style="font-family:'Times New Roman'; font-size:12pt">ASCII</span><span style="font-family:宋体; font-size:12pt">码。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">字符显示驱动子程序：从</span><span style="font-family:'Times New Roman'; font-size:12pt">ASCII</span><span style="font-family:宋体; font-size:12pt">到字模库到显示</span><span style="font-family:'Times New Roman'; font-size:12pt">vram</span><span style="font-family:宋体; font-size:12pt">（存储每一个点的</span><span style="font-family:'Times New Roman'; font-size:12pt">RGB</span><span style="font-family:宋体; font-size:12pt">颜色信息）。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; widows:0"><span style="font-family:宋体; font-size:12pt">显示芯片按照刷新频率逐行读取</span><span style="font-family:'Times New Roman'; font-size:12pt">vram</span><span style="font-family:宋体; font-size:12pt">，并通过信号线向液晶显示器传输每一个点（</span><span style="font-family:'Times New Roman'; font-size:12pt">RGB</span><span style="font-family:宋体; font-size:12pt">分量）。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238449"><span style="font-family:黑体; font-size:15pt">8.4 getchar的实现分析</span></a></h2><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">1.int getchar(void)    </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">2.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">{    </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">3.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    static char buf[BUFSIZ];    </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">4.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    static char *bb = buf;    </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">5.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    static int n = 0;    </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">6.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    if(n == 0)    </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">7.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    {    </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">8.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">        n = read(0, buf, BUFSIZ);    </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">9.</span><span style="width:9pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">        bb = buf;    </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">10.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    }    </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">11.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">    return(--n &gt;= 0)?(unsigned char) *bb++ : EOF;    </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">12.</span><span style="width:3pt; text-indent:0pt; display:inline-block"></span><span style="font-family:'Times New Roman'; font-size:12pt">}   </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">getchar</span><span style="font-family:宋体; font-size:12pt">函数调用</span><span style="font-family:'Times New Roman'; font-size:12pt">read</span><span style="font-family:宋体; font-size:12pt">函数，将整个缓冲区都读到</span><span style="font-family:'Times New Roman'; font-size:12pt">buf</span><span style="font-family:宋体; font-size:12pt">里，并将缓冲区的长度赋值给</span><span style="font-family:'Times New Roman'; font-size:12pt">n</span><span style="font-family:宋体; font-size:12pt">。返回时返回</span><span style="font-family:'Times New Roman'; font-size:12pt">buf</span><span style="font-family:宋体; font-size:12pt">的第一个元素，除非</span><span style="font-family:'Times New Roman'; font-size:12pt">n&lt;0</span><span style="font-family:宋体; font-size:12pt">。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">异步异常</span><span style="font-family:'Times New Roman'; font-size:12pt">-</span><span style="font-family:宋体; font-size:12pt">键盘中断的处理：键盘中断处理子程序。接受按键扫描码转成</span><span style="font-family:'Times New Roman'; font-size:12pt">ascii</span><span style="font-family:宋体; font-size:12pt">码，保存到系统的键盘缓冲区。</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">getchar</span><span style="font-family:宋体; font-size:12pt">等调用</span><span style="font-family:'Times New Roman'; font-size:12pt">read</span><span style="font-family:宋体; font-size:12pt">系统函数，通过系统调用读取按键</span><span style="font-family:'Times New Roman'; font-size:12pt">ascii</span><span style="font-family:宋体; font-size:12pt">码，直到接受到回车键才返回。</span></p><h2 style="font-weight:normal; line-height:19pt; margin:12pt 0pt; orphans:0; text-align:justify; widows:0"><a name="_Toc532238450"><span style="font-family:黑体; font-size:15pt">8.5本章小结</span></a></h2><p style="margin:5pt 0pt"><span style="font-family:宋体; font-size:12pt">系统级</span><span style="font-family:'Times New Roman'; font-size:12pt">I/O</span><span style="font-family:宋体; font-size:12pt">完成了</span><span style="font-family:'Times New Roman'; font-size:12pt">Hello</span><span style="font-family:宋体; font-size:12pt">一生的最后一步。</span></p><p style="margin:5pt 0pt"><span style="font-family:宋体; font-size:12pt">以文件为单位，保证了较高的读写速度。</span></p><p style="margin:5pt 0pt"><span style="font-family:宋体; font-size:12pt">在各个层次上，这样的分块抽象，极大地提高了计算机的处理性能。</span></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">（第</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">8</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">章</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">1</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">分）</span></p><h1 style="line-height:40pt; margin:20pt 0pt 10pt; orphans:0; text-align:center; widows:0"><a name="_Toc532238451"><span style="font-family:黑体; font-size:18pt; font-weight:bold">结论</span></a></h1><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">预处理阶段：</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.c</span><span style="font-family:宋体; font-size:12pt">引用的所有外部的库和宏定义展开合并到一个</span><span style="font-family:宋体; font-size:12pt"> </span><span style="font-family:'Times New Roman'; font-size:12pt">hello.i </span><span style="font-family:宋体; font-size:12pt">的文本文件中。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">编译阶段：</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.i</span><span style="font-family:宋体; font-size:12pt">文件编译成为汇编文件</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.s</span><span style="font-family:宋体; font-size:12pt">，形成汇编指令。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">汇编阶段：将</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.s </span><span style="font-family:宋体; font-size:12pt">文件汇编成为可重定位目标文件</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.o</span><span style="font-family:宋体; font-size:12pt">，这个文件是二进制文件，但仍需要重定位。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">链接阶段：将</span><span style="font-family:'Times New Roman'; font-size:12pt">hello.o</span><span style="font-family:宋体; font-size:12pt">与可重定位目标文件和动态链接库链接成为可执行程序</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">，此时的</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">可以被</span><span style="font-family:'Times New Roman'; font-size:12pt">shell</span><span style="font-family:宋体; font-size:12pt">执行。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">Shell</span><span style="font-family:宋体; font-size:12pt">：在</span><span style="font-family:宋体; font-size:12pt"> </span><span style="font-family:'Times New Roman'; font-size:12pt">shell</span><span style="font-family:宋体; font-size:12pt">程序中输入</span><span style="font-family:'Times New Roman'; font-size:12pt">./hello 11</span><span style="font-family:'Times New Roman'; font-size:12pt">80301009 </span><span style="font-family:宋体; font-size:12pt">阚嘉良</span><span style="font-family:宋体; font-size:12pt">，</span><span style="font-family:'Times New Roman'; font-size:12pt">shell</span><span style="font-family:宋体; font-size:12pt">解析命令行，调用</span><span style="font-family:宋体; font-size:12pt"> </span><span style="font-family:'Times New Roman'; font-size:12pt">fork </span><span style="font-family:宋体; font-size:12pt">为其创建一个子进程，调用</span><span style="font-family:'Times New Roman'; font-size:12pt">execve</span><span style="font-family:宋体; font-size:12pt">函数，启动加载器，将</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">加载进内存，此时的</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">成为了一个进程。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">执行阶段：</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">按照时间片进行运行，相应各种信号和异常。在这个过程中：访存阶段：</span><span style="font-family:'Times New Roman'; font-size:12pt">MMU</span><span style="font-family:宋体; font-size:12pt">将程序中的虚拟内存地址通过页表映射成物理地址。通过</span><span style="font-family:'Times New Roman'; font-size:12pt">L</span><span style="font-family:'Times New Roman'; font-size:12pt">1L2L3</span><span style="font-family:'Times New Roman'; font-size:12pt">cache</span><span style="font-family:宋体; font-size:12pt">加快数据访问。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt">动态内存申请阶段：</span><span style="font-family:'Times New Roman'; font-size:12pt">printf</span><span style="font-family:宋体; font-size:12pt">调用</span><span style="font-family:'Times New Roman'; font-size:12pt">malloc</span><span style="font-family:宋体; font-size:12pt">函数向动态内存分配器申请堆中的内存。回收阶段：</span><span style="font-family:'Times New Roman'; font-size:12pt">hello</span><span style="font-family:宋体; font-size:12pt">进程结束，成为僵尸进程，</span><span style="font-family:'Times New Roman'; font-size:12pt">shell</span><span style="font-family:宋体; font-size:12pt">父进程回收子进程，内核删除这个进程的所有数据。</span></p><p style="margin:0pt; orphans:0; text-align:justify; text-indent:24pt; widows:0"><span style="font-family:宋体; font-size:12pt"> </span><span style="font-family:宋体; font-size:12pt">   </span><span style="font-family:宋体; font-size:12pt">在整个过程中，我们的存储管理以及页表的使用，都离不开局部性对我们进行支持，可以说，局部性是现代计算机系统的构建基础。。</span></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">（结论</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">0</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">分，缺失 </span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">-1</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">分，根据内容酌情加分）</span></p><h1 style="line-height:40pt; margin:20pt 0pt 10pt; orphans:0; text-align:center; widows:0"><a name="_Toc225579656"></a><a name="_Toc250450180"><br style="page-break-before:always; clear:both" /></a><a name="_Toc532238452"><span style="font-family:黑体; font-size:18pt; font-weight:bold">附件</span></a></h1><table cellspacing="0" cellpadding="0" style="border-collapse:collapse; margin-left:0pt"><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:bold; vertical-align:baseline">hello.i</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:宋体; font-size:12pt; font-weight:bold; vertical-align:baseline">预编译处理文件</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:bold; vertical-align:baseline">Hello.s</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:宋体; font-size:12pt; font-weight:bold; vertical-align:baseline">汇编文件</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:bold; vertical-align:baseline">Hello.o</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:宋体; font-size:12pt; font-weight:bold; vertical-align:baseline">由</span><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:bold; vertical-align:baseline">hello.c</span><span style="font-family:宋体; font-size:12pt; font-weight:bold; vertical-align:baseline">生成的可重定位文件</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:bold; vertical-align:baseline">Hello</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:宋体; font-size:12pt; font-weight:bold; vertical-align:baseline">链接后的可执行文件</span></p></td></tr><tr><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.2pt"><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt; font-weight:bold; vertical-align:baseline">Hello.c</span></p></td><td style="border-bottom-color:#000000; border-bottom-style:solid; border-bottom-width:0.75pt; border-left-color:#000000; border-left-style:solid; border-left-width:0.75pt; border-right-color:#000000; border-right-style:solid; border-right-width:0.75pt; border-top-color:#000000; border-top-style:solid; border-top-width:0.75pt; padding-left:5.03pt; padding-right:5.03pt; vertical-align:top; width:207.25pt"><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:宋体; font-size:12pt; font-weight:bold; vertical-align:baseline">源文件</span></p></td></tr></table><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">（附件</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">0</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">分，缺失 </span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">-1</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">分）</span></p><h1 style="line-height:40pt; margin:20pt 0pt 10pt; orphans:0; text-align:center; widows:0"><br style="page-break-before:always; clear:both" /><a name="_Toc532238453"><span style="font-family:黑体; font-size:18pt; font-weight:bold">参考文献</span><span style="-aw-bookmark-end:_Toc225579656"></span><span style="-aw-bookmark-end:_Toc250450180"></span></a></h1><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="color:#ff0000; font-family:黑体; font-size:12pt; font-weight:bold">为完成本次大作业你翻阅的书籍与网站等</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; padding-left:26.15pt; text-align:justify; text-indent:-26.15pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">[1] </span><span style="font-family:宋体; font-size:12pt">深入理解计算机系统教材</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; padding-left:26.15pt; text-align:justify; text-indent:-26.15pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">[2] </span><a href="https://www.cnblogs.com/pianist/p/3315801.html"><span style="color:#0000ff; font-family:宋体; font-size:10.5pt; text-decoration:underline">https://www.cnblogs.com/pianist/p/3315801.html</span></a></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; padding-left:26.15pt; text-align:justify; text-indent:-26.15pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">[3] </span><a href="https://www.cnblogs.com/wangcp-2014/p/5146343.html"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; text-decoration:underline">https://www.cnblogs.com/wangcp-2014/p/5146343.html</span></a></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; padding-left:26.15pt; text-align:justify; text-indent:-26.15pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">[4] </span><a href="https://blog.csdn.net/ky_heart/article/details/51865526"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; text-decoration:underline">https://blog.csdn.net/ky_heart/article/details/51865526</span></a></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; padding-left:26.15pt; text-align:justify; text-indent:-26.15pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">[5]</span><span style="font-family:'Times New Roman'; font-size:12pt"> </span><a href="https://blog.csdn.net/weixin_43836778/article/details/90903213"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; text-decoration:underline">https://blog.csdn.net/weixin_43836778/article/details/90903213</span></a><span style="font-family:'Times New Roman'; font-size:12pt"> </span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; padding-left:26.15pt; text-align:justify; text-indent:-26.15pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">[6]</span><span style="font-family:'Times New Roman'; font-size:12pt"> </span><a href="https://github.com/dylanmckay/vsprintf"><span style="color:#0000ff; font-family:'Times New Roman'; font-size:12pt; text-decoration:underline">https://github.com/dylanmckay/vsprintf</span></a></p><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">（参考文献</span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">0</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">分，缺失 </span><span style="color:#ff0000; font-family:'Times New Roman'; font-size:12pt; font-weight:bold">-1</span><span style="color:#ff0000; font-family:宋体; font-size:12pt; font-weight:bold">分）</span></p><p style="font-size:12pt; line-height:125%; margin:0pt; orphans:0; padding-left:26.15pt; text-align:justify; text-indent:-26.15pt; widows:0"><span style="font-family:'Times New Roman'; font-size:12pt">&#xa0;</span></p></div><div class="cnzz" style="display: none;">
	        <script src="https://s23.cnzz.com/z_stat.php?id=1277655852&web_id=1277655852" language="JavaScript"></script>
            </div>
            <div class="docpe" style="position: absolute;color: white;margin-left:-450;">
            <a target="_blank" href="http://www.docpe.com">档铺网——在线文档免费处理</a>
            </div>
            </body></html>